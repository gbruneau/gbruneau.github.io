import"https://cdn.skypack.dev/leaflet@1.7.1";import"https://cdn.skypack.dev/leaflet-rotate@0.1.4";import"https://cdn.skypack.dev/jquery";import"https://maxwell-ilai.github.io/Leaflet.SidePanel/dist/leaflet-sidepanel.min.js";import"https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.js";import"https://unpkg.com/leaflet-geotag-photo/dist/Leaflet.GeotagPhoto.min.js";import{v as N}from"./vendor.70f0e448.js";const Re=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}};Re();var Fe=202507041528e-4;const $e=[{catID:"BASE",en:"Base Map",fr:"Carte de base",es:"Mapa base"},{catID:"TOPO",en:"Topography",fr:"Topographie",es:"topogr\xE1fico"},{catID:"IMGE",en:"Imagery",fr:"Imagerie",es:"Im\xE1genes"},{catID:"TRAN",en:"Transport",fr:"Transport",es:"Transporte"},{catID:"MISC",en:"Miscelaneoud",fr:"Divers",es:"Miscel\xE1neas"}],Ge=[{providerKeyName:"Thunderforest",providerKeyValue:"538d4534960f4226bb8ca146e7df3941"},{providerKeyName:"jawg",providerKeyValue:"e9xKxlmCUuPGGQvk3FYwqWWmXgyvomdDUECpkBfjQA1obipCjNRKwWlHd1pYr5K2"},{providerKeyName:"tracestrack",providerKeyValue:"8e2a46ccbd594da9395b97cf521da27a"},{providerKeyName:"stadiamaps",providerKeyValue:"b47c1f97-1372-4024-b0cf-d60b46bb1787"},{providerKeyName:"here",providerKeyValue:"NHG82qG2ayXOLV2PQKbPG1Pbt393JTTJ-oX8KkZMdyw"}],_e=[{BMKey:0,catID:"BASE",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'OSM Mapnik <a href="http://www.openstreetmap.org/copyright">OpenStreetMap ORG</a>',minZoom:1,maxZoom:19,BMname:"Open Street Map",BMicon:"Mapnik.png"},{BMKey:3,catID:"BASE",url:"//{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",attribution:'Map data \xA9 <a href="http://openstreetmap.org">OpenStreetMap FR</a> contributors',maxZoom:20,minZoom:0,BMname:"OSM France",BMicon:"osmFR.png"},{BMKey:1,catID:"BASE",url:"https://tile.jawg.io/4284c312-895e-4aa5-9c79-c8974c53f9d3/{z}/{x}/{y}{r}.png?access-token={key}",keyProvider:"jawg",BMname:"Jawg GB",BMicon:"Jawg_GBMain.png",minZoom:0,maxZoom:22,subdomains:"abcd",attribution:'<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},{BMKey:2,catID:"BASE",url:"http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",subdomains:["mt0","mt1","mt2","mt3"],BMname:"Google Map",BMicon:"GoogleMap.png",attribution:'<a href="https://maps.google.com">google Map</a>',maxZoom:20},{BMKey:7,catID:"BASE",url:"https://{s}.tile.thunderforest.com/neighbourhood/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Neighbourhood",BMicon:"Thunderforest_Neighbourhood.png"},{BMKey:6,catID:"BASE",url:"https://server.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; National Geographic, Esri, DeLorme, NAVTEQ, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, iPCy",BMname:"National Geographic",BMicon:"Esri_NatGeoWorldMap.png"},{BMKey:5,catID:"BASE",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community",BMname:"ESRI Street",BMicon:"ESRIMap.png"},{BMKey:4,catID:"BASE",url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Tiles style by <a href="https://www.hotosm.org/" target="_blank">Humanitarian OpenStreetMap Team</a> hosted by <a href="https://openstreetmap.fr" target="_blank">OpenStreetMap France</a>',maxZoom:19,BMname:"Humanitarian OSM",BMicon:"osmHOT.png"},{BMKey:25,catID:"TOPO",url:"https://tile.tracestrack.com/topo_fr/{z}/{x}/{y}.png?key={key}",keyProvider:"tracestrack",BMname:"Tracestack Topo",BMicon:"Tracestrack_Topo.png",attribution:'Data: \xA9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>, <a href="https://worldcover2021.esa.int">ESA WorldCover</a>; Maps \xA9 <a href="https://www.tracestrack.com/">Tracestrack</a>',minZoom:0,maxZoom:19},{BMKey:8,catID:"TOPO",url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",maxZoom:17,attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',BMname:"Open Topo Map",BMicon:"OpenTopoMap.png"},{BMKey:11,catID:"TOPO",url:"http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}",subdomains:["mt0","mt1","mt2","mt3"],BMname:"Google Terrain",BMicon:"GoogleTerrain.png",attribution:'<a href="https://maps.google.com">google Map</a>'},{BMKey:12,catID:"TOPO",url:"https://tiles.stadiamaps.com/tiles/stamen_terrain/{z}/{x}/{y}.{ext}",attribution:'Map tiles by <a href="http://stadiamaps.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:1,maxZoom:18,ext:"png",BMname:"Stamen Terrain",BMicon:"Stamen_Terrain.png"},{BMKey:9,catID:"TOPO",url:"https://{s}.tile.thunderforest.com/outdoors/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Outdoors",BMicon:"Thunderforest_Outdoors.png"},{BMKey:10,catID:"TOPO",url:"https://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Landscape",BMicon:"Thunderforest_Landscape.png"},{BMKey:13,catID:"TOPO",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community",BMname:"ESRI Topo",BMicon:"ESRITopo.png"},{BMKey:30,catID:"TOPO",url:"http://sgx.geodatenzentrum.de/wmts_topplus_open/tile/1.0.0/web/default/WEBMERCATOR/{z}/{y}/{x}.png",maxZoom:13,attribution:'Map data: &copy; <a href="http://www.govdata.de/dl-de/by-2-0">dl-de/by-2-0</a>',BMname:"Top Plus",BMicon:"TopPlus.png"},{BMKey:14,catID:"IMGE",url:"http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",subdomains:["mt0","mt1","mt2","mt3"],BMname:"Google Satellite",BMicon:"GoogleSat.png",minZoom:1,maxZoom:21,attribution:'<a href="https://maps.google.com">google Map</a>'},{BMKey:3026,catID:"IMGE",url:"https://1.aerial.maps.ls.hereapi.com/maptile/2.1/maptile/newest/satellite.day/{z}/{x}/{y}/512/jpg?apiKey={key}",attribution:"Here Map",minZoom:1,maxZoom:19,BMname:"Here Satellite",BMicon:"Here_Satellite.jpg",keyProvider:"here"},{BMKey:15,catID:"IMGE",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",BMname:"ESRI Image",BMicon:"ESRIImg.png",minZoom:1,maxZoom:21,attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"},{BMKey:21,catID:"TRAN",url:"https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png",attribution:'<a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:20,BMname:"CartoDB Voyager",BMicon:"CartoDB_VoyagerLabelsUnder.png"},{BMKey:17,catID:"TRAN",url:"https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Transport",BMicon:"Thunderforest_Transport.png"},{BMKey:20,catID:"TRAN",url:"https://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Cycle",BMicon:"Thunderforest_OpenCycleMap.png"},{BMKey:19,catID:"TRAN",url:"https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",maxZoom:20,attribution:'<a href="https://github.com/cyclosm/cyclosm-cartocss-style/releases" title="CyclOSM - Open Bicycle render">CyclOSM</a> | Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',BMname:"Cyclo OSM",BMicon:"CyclOSM.png"},{BMKey:28,catID:"TRAN",url:"https://tileserver.memomaps.de/tilegen/{z}/{x}/{y}.png",minZoom:0,maxZoom:18,BMname:"OPNV Karte",BMicon:"OPNVKarte.png",attribution:'Map <a href="https://memomaps.de/">memomaps.de</a> <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},{BMKey:16,catID:"TRAN",url:"https://{s}.tile.thunderforest.com/mobile-atlas/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Mobile Atlas",BMicon:"Thunderforest_MobileAtlas.png"},{BMKey:18,catID:"TRAN",url:"https://{s}.tile.thunderforest.com/transport-dark/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Transport Dark",BMicon:"Thunderforest_TransportDark.png"},{BMKey:27,catID:"MISC",url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",minZoom:0,maxZoom:20,BMname:"CartoDB Positron",BMicon:"CartoDB_Positron.png"},{BMKey:23,catID:"MISC",url:"https://tiles.stadiamaps.com/tiles/stamen_toner_lite/{z}/{x}/{y}{r}.{ext}",BMname:"Stamen Toner Lite",BMicon:"Stamen_TonerLite.png",attribution:'Map tiles by <a href="http://stadiamaps.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:0,maxZoom:20,ext:"png"},{BMKey:29,catID:"MISC",url:"https://tile.jawg.io/jawg-light/{z}/{x}/{y}{r}.png?access-token={key}",keyProvider:"jawg",BMname:"Jawg Light",BMicon:"JawgLight.png",minZoom:0,maxZoom:22,subdomains:"abcd",attribution:'<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},{BMKey:31,catID:"MISC",url:"https://tile.jawg.io/jawg-dark/{z}/{x}/{y}{r}.png?access-token={key}",keyProvider:"jawg",BMname:"Jawg Dark",BMicon:"JawgDark.png",minZoom:0,maxZoom:22,subdomains:"abcd",attribution:'<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},{BMKey:22,catID:"MISC",url:"https://{s}.tile.thunderforest.com/pioneer/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Pioneer",BMicon:"Thunderforest_Pioneer.png"},{BMKey:24,catID:"MISC",url:"https://tiles.stadiamaps.com/tiles/stamen_watercolor/{z}/{x}/{y}.{ext}",attribution:'Map tiles by <a href="http://stadiamaps.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:1,maxZoom:16,ext:"jpg",BMname:"Stamen Watercolor",BMicon:"Stamen_Watercolor.jpg"}],Ue=[{BMKey:5e3,url:"https://tile.tracestrack.com/subway-route/{z}/{x}/{y}.png?key={key}",keyProvider:"tracestrack",BMname:"Tracestrack Subway",BMicon:"Tracestrack_Subway.png",attribution:'Data: \xA9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>, <a href="https://worldcover2021.esa.int">ESA WorldCover</a>; Maps \xA9 <a href="https://www.tracestrack.com/">Tracestrack</a>',minZoom:8,maxZoom:19},{BMKey:5020,url:"https://tile.tracestrack.com/bus-route/{z}/{x}/{y}.png?key={key}",keyProvider:"tracestrack",BMname:"Tracestrack Bus",BMicon:"Tracestrack_Bus.png",attribution:'Data: \xA9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>, <a href="https://worldcover2021.esa.int">ESA WorldCover</a>; Maps \xA9 <a href="https://www.tracestrack.com/">Tracestrack</a>',minZoom:8,maxZoom:19},{BMKey:5030,url:"https://tile.tracestrack.com/train-route/{z}/{x}/{y}.png?key={key}",keyProvider:"tracestrack",BMname:"Tracestrack Train",BMicon:"Tracestrack_Train.png",attribution:'Data: \xA9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>, <a href="https://worldcover2021.esa.int">ESA WorldCover</a>; Maps \xA9 <a href="https://www.tracestrack.com/">Tracestrack</a>',minZoom:0,maxZoom:19},{BMKey:5040,url:"https://{s}.tiles.openrailwaymap.org/standard/{z}/{x}/{y}.png",BMname:"Open Railway",BMicon:"OpenRailway.png",minZoom:0,maxZoom:19,attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors | Map style: &copy; <a href="https://www.OpenRailwayMap.org">OpenRailwayMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'},{BMKey:5500,url:"https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",BMname:"Open Sea Map",BMicon:"openseamap.png",attribution:'Map data: &copy; <a href="http://www.openseamap.org">OpenSeaMap</a> contributors',minZoom:8},{BMKey:5600,url:"https://tile.tracestrack.com/bicycle-route/{z}/{x}/{y}.png?key={key}",keyProvider:"tracestrack",BMname:"Tracestrack Bike",BMicon:"Tracestrack_Bike.png",attribution:'Data: \xA9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>, <a href="https://worldcover2021.esa.int">ESA WorldCover</a>; Maps \xA9 <a href="https://www.tracestrack.com/">Tracestrack</a>',minZoom:8,maxZoom:19},{BMKey:5610,url:"https://tile.waymarkedtrails.org/cycling/{z}/{x}/{y}.png",BMname:"Waymarked Cycling",BMicon:"WaymarkedCycling.png",minZoom:0,maxZoom:18,attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors | Map style: &copy; <a href="https://waymarkedtrails.org">waymarkedtrails.org</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'},{BMKey:5650,url:"https://tile.waymarkedtrails.org/slopes/{z}/{x}/{y}.png",BMname:"Waymarked Ski",BMicon:"WaymarkedSki.png",minZoom:4,maxZoom:18,attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors | Map style: &copy; <a href="https://waymarkedtrails.org">waymarkedtrails.org</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'},{BMKey:5700,url:"https://servicesvecto3.mern.gouv.qc.ca/geoserver/ZoneInondable_Pub/ows",BMname:"Qu\xE9bec: Zone Innondables",BMicon:"qcZoneInondable.png",attribution:'<a href="https://mern.gouv.qc.ca">MERN Qu\xE9bec</a>',minZoom:6,layerType:1,layers:"ZONE_INONDABLE",style:"",format:"image/png",transparent:!0,continuousworld:!0},{BMKey:5710,url:"https://servicescarto.mern.gouv.qc.ca/pes/services/Territoire/GRHQ_WMS/MapServer/WMSServer",BMname:"Qu\xE9bec: Hydrographie",BMicon:"qcHydrographie.png",attribution:'<a href="https://geoegl.msp.gouv.qc.ca">Gouvernement du Qu\xE9bec</a>',minZoom:13,layerType:1,layers:"Surface [125K - 1]",style:"",format:"image/png",transparent:!0,continuousworld:!0},{BMKey:5800,url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",BMname:"Qu\xE9bec: \xC9levage",BMicon:"qcElevage.png",attribution:'<a href="https://geoegl.msp.gouv.qc.ca">Gouvernement du Qu\xE9bec</a>',minZoom:8,layerType:1,layers:"REQ_ELEVAGE_BETAIL_P,REQ_ABATTOIR_P",version:"1.3.0",CRS:"EPSG:3857",format:"image/png",transparent:!0,continuousworld:!0,styles:"",tiled:!0}];var A={categories:$e,providerKeys:Ge,layers:_e,overlays:Ue};const He=10,qe=46.80960630088855,Je=-71.21267080307008,je=0,Ve=!1,We=25,Qe="New map";var E={z:He,lat:qe,lng:Je,rot:je,m:Ve,l:We,t:Qe};const Ye={languages:{en:"English",fr:"Fran\xE7ais",es:"Espa\xF1ol"},fallback:"en"},Xe={youhere:{fr:"Vous \xEAtes ici",en:"You are here",es:"Usted est\xE1 aqu\xED"},expjson:{fr:"Exporter en JSON",en:"Export to JSON",es:"Exportar a JSON"},impfavfile:{fr:"Importer le fichier des favoris",en:"Import favorites file",es:"Importar archivo de favoritos"},selfav:{en:"Select file",es:"Seleccione Archivo",fr:"Choisir le fichier"},cancel:{en:"Cancel",es:"Cancelar",fr:"Annuler"},upload:{en:"Upload",fr:"T\xE9l\xE9verser",es:"Cargar"},confirm:{en:"Confirm",fr:"Confirmer",es:"Confirmar"},yes:{en:"Yes",fr:"Oui",es:"Si"},no:{en:"No",fr:"Non",es:"No"},layerselec:{en:"Map selector",fr:"S\xE9lecteur de carte",es:"Selector de mapa"},overlaysel:{en:"Overlay selector",fr:"S\xE9lecteur couche",es:"Selector de capa"},overlay:{en:"Overlay",fr:"Couche",es:"Capas"},tools:{en:"Tools",fr:"Outils",es:"Herramientas"},favplace:{en:"Favorites places",fr:"Lieux pr\xE9f\xE9r\xE9s",es:"Lugares favoritos"},aboutbm:{en:"About BestMap",fr:"\xC0 propos de BestMap",es:"Acerca de BestMap"},maptools:{en:"Map Tools",fr:"Outils cartographiques",es:"Herramientas de mapa"},search:{en:"Search",fr:"Chercher",es:"Buscar"},addrexample:{en:"99 main street, city, state, country",fr:"99 Rue untel,ville,province,pays",es:"99 Calle 12,ciudad, dept., pa\xEDs"},mapNameExample:{en:"Place name",fr:"Nom du lieu",es:"Top\xF3nimo"},pref:{en:"Preferences",fr:"Pr\xE9f\xE9rences",es:"Preferencias"},save:{en:"Save",fr:"Sauvegarder",es:"Guardar"},weeelzoom:{en:"SHIFT + Mouse weel to rotate",fr:"MAJ + Molette de la souris pour faire pivoter",es:"MAY\xDAS + rueda del rat\xF3n para girar"},marker:{en:"Marker",fr:"Marqueur",es:"Marcador"},gocurpos:{en:"Go to current position",fr:"Aller \xE0 votre position actuel",es:"Ir a tu ubicaci\xF3n actual"},trackpos:{en:"Track position",fr:"Suivre la position",es:"Seguir posici\xF3n"},measure:{en:"Measure",fr:"Mesurer",es:"Medir"},openin:{en:"Open in",fr:"Ouvrir dans",es:"Abrir en"},favsaved:{en:"Favorite saved places",fr:"Lieux sauvegard\xE9s favoris",es:"Lugares guardados favoritos"},savechange:{en:"Save changes",fr:"Sauvegarder les changements",es:"Guardar"},undo:{en:"Undo",fr:"Annuler",es:"Cancelar"},impJSON:{en:"Import BestMap JSON file",fr:"Importer fichier JSON BestMap",es:"Importar archivo JSON de BestMap"},expJSON:{en:"Export to BestMap JSON file",fr:"Exporter vers fichier JSON BestMap",es:"Exportar a archivo JSON de BestMap"},expGeoJSON:{en:"Export to GeoJSON file",fr:"Exporter vers un fichier GeoJSON",es:"CanExportar a archivo GeoJSONcelar"},expKML:{en:"Export to KML file",fr:"Exporter vers un fichier KML",es:"CanExportar a archivo KML"},addviewtofav:{en:"Add current view to favorites",fr:"Ajouter la vue actuels aux favoris",es:"Agregar la vista actual"},addQuicktofav:{en:"Add device position to favorites",fr:"Ajouter la position de l'appareil aux favoris",es:"A\xF1adir la posici\xF3n del dispositivo a favoritos"},placename:{en:"Place Name",fr:"Nom de lieu",es:"Nombre del lugar geogr\xE1fico"},place:{en:"Place",fr:"Lieu",es:"Lugar"},golocation:{en:"View the location",fr:"Afficher",es:"Ver lugar"},view:{en:"View",fr:"",es:"Ver"},updateview:{en:"Update URL with current location and view",fr:"Mettre \xE0 jour avec l'emplacement et la vue actuel",es:"Actualizar con ubicaci\xF3n y vista actual"},update:{en:"Update",fr:"Mettre \xE0 jour",es:"Actualizar"},delplace:{en:"Delete this place",fr:"Supprimer cet endroit",es:"Eliminar este lugar"},delete:{en:"Delete",fr:"Supprimer",es:"Eliminar"},chooselang:{en:"Choose a language:",fr:"Choisissez une langue",es:"Seleccione un idioma:"},author:{en:"Author:",fr:"Auteur:",es:"Autor:"},mapname:{en:"Place Name",fr:"Lieu",es:"Lugar"},basemap:{en:"Base Map:",fr:"Carte de base:",es:"Mapa base:"},lat:{en:"Latitude:",fr:"Latitude:",es:"Latitud:"},lng:{en:"Longitude:",fr:"Longitude:",es:"Longitud:"},zoom:{en:"Zoom:",fr:"Zoom:",es:"Zoom"},bmid:{en:"Base Map ID:",fr:"ID Carte de base:",es:"ID Mapa base"},editcurpos:{en:"Edit Current Position:",fr:"Modifier la vue actuelle:",es:"Editar posici\xF3n actual"},shareclipboard:{en:"Share to Clipboard:",fr:"Partager dans le presse-papiers ::",es:"Compartir en el portapapeles:"},shareemail:{en:"Share by e-mail:",fr:"Partager par courriel:",es:"Compartir por correo electr\xF3nico:"},backtoNorth:{en:"Rotate to north",fr:"Retour au nord",es:"De vuelta al norte"}};var g={language:Ye,labels:Xe};const Q={defaultState:0,url:1,device:2};var m={lang:"fr"},ce={tile:0,wms:1};Le();var ve=Q.defaultState,he="hsl(197, 100%, 60%)",et=window.location.search,p=new URLSearchParams(et),Me=p.has("z")==!0?Number(p.get("z")):E.z,Be=p.has("lat")==!0?Number(p.get("lat")):E.lat,be=p.has("lng")==!0?Number(p.get("lng")):E.lng,we=p.has("rot")==!0?Number(p.get("rot")):E.rot,de=p.has("m")==!0?p.get("m").toString()=="true":E.m,Ee=p.has("t")==!0?p.get("t"):E.t,ke=p.has("l")==!0?p.get("l"):E.l;const tt=1e3;p.has("lat")==!0&&p.has("lng")==!0&&(ve=Q.url);var v=[];for(const t of A.categories){var J={catID:t.catID,category:m.lang=="fr"?t.fr:t.en,layers:[]};for(const e of A.layers)if(e.catID==J.catID){var I=e.url;if(e.keyProvider!==void 0){var P=Ce(e.keyProvider);P!==void 0&&(I=e.url.replace("{key}",P))}var c=L.tileLayer(I,{});e.BMKey!==void 0&&(c.options.BMKey=e.BMKey),e.BMname!==void 0&&(c.options.BMname=e.BMname),e.BMicon!==void 0&&(c.options.BMicon=e.BMicon),e.BMicon!==void 0&&(c.options.BMicon=e.BMicon),e.attribution!==void 0&&(c.options.attribution=e.attribution),e.minZoom!==void 0?c.options.minZoom=e.minZoom:c.options.minZoom=0,e.maxZoom!==void 0?c.options.maxZoom=e.maxZoom:c.options.maxZoom=22,e.subdomains!==void 0&&(c.options.subdomains=e.subdomains),e.ext!==void 0&&(c.options.ext=e.ext),c.options.isOverlay=!1,c.options.pane="tilePane",J.layers.push(c)}v.push(J)}var Y=[];for(const t of A.overlays){var I=t.url;if(t.keyProvider!==void 0){var P=Ce(t.keyProvider);P!==void 0&&(I=t.url.replace("{key}",P))}var pe=ce.tile,j={};for(var h in t)t[h]!==void 0&&(j[h]=t[h]);if(t.layerType!==void 0&&(pe=t.layerType),pe==ce.wms)var c=L.tileLayer.wms(I,j);else var c=L.tileLayer(I,j);c.options.isOverlay=!0,c.options.pane="overlayPane",Y.push(c)}var n=L.map("map",{center:new L.LatLng(Be,be),zoom:Me,zoomControl:!1,rotate:!0,touchRotate:!0,rotateControl:!1,BMHasMarker:!1,BMTitle:Ee,bearing:we,attributionControl:!0,BMHasMeasure:!1,BMHasTracker:!1,BMCurrentLayerKey:0}),f={},at=ne(ke);n.addLayer(at);document.getElementById("buildFld").value=Fe;L.control.sidepanel("panelID",{panelPosition:"left",hasTabs:!0,tabsPosition:"top",pushControls:!0,darkMode:!0,startTab:"tab-layer"}).addTo(n);var Ie=L.control({position:"topright"});Ie.onAdd=function(t){var e=L.DomUtil.create("div","info legend nArrow");return e.setAttribute("data-title","backtoNorth"),e.innerHTML="\u27F4",e};Ie.addTo(n);var ot=document.querySelector(".nArrow");ot.addEventListener("click",function(t){n.setBearing(0)});let Se=L.control.polylineMeasure({position:"topright",unit:"kilometres",showBearings:!1,clearMeasurementsOnStop:!0,showClearControl:!1,showUnitControl:!1,startCircle:{color:"#000",weight:2,fillColor:"#0f0",fillOpacity:1,radius:6},intermedCircle:{color:"#000",weight:2,fillColor:"#ff0",fillOpacity:1,radius:4},currentCircle:{color:"#000",weight:1,fillColor:"#f0f",fillOpacity:1,radius:3},endCircle:{color:"#000",weight:2,fillColor:"#f00",fillOpacity:1,radius:6},tempLine:{color:"#00f",weight:1},fixedLine:{color:"#00C",weight:3}});Se.addTo(n);document.querySelector(".polyline-measure-unicode-icon").parentNode.style.display="none";n.on("rotate",function(t){G(re(n.getBearing()))});n.on("resizeend",function(t){M(C()),B(O()),K(Z())});n.on("zoomend",function(t){K(n.getZoom())});n.on("moveend",function(t){M(C()),B(O())});de?Ze():_(de);yt();ft();vt();ht();Tt();Lt();Ot();w(Ee);G(we);M(Be);B(be);K(Me);Ne(ke);Oe(!1);xe(!1);let Te,X=!1,ee=!1;var te=indexedDB.open("BestMapDB",1),T,b="BMFavorite";te.onerror=function(t){console.log("Database error: "+t.target.errorCode)};te.onsuccess=function(t){T=t.target.result,console.log("Database opened successfully"),De()};te.onupgradeneeded=function(t){T=t.target.result;var e=T.createObjectStore(b,{keyPath:"t"});e.createIndex("m","m",{unique:!1}),e.createIndex("rot","rot",{unique:!1}),e.createIndex("l","l",{unique:!1}),e.createIndex("lat","lat",{unique:!1}),e.createIndex("lng","lng",{unique:!1}),e.createIndex("z","z",{unique:!1})};document.getElementById("dlgUpload").style.display="none";document.getElementById("dlgconfirm").style.display="none";navigator.geolocation&&ve==Q.defaultState&&navigator.geolocation.getCurrentPosition(lt);var rt=document.getElementById("languageDropdown");for(var h in g.language.languages)if(g.language.languages.hasOwnProperty(h)){var R=document.createElement("option");R.value=h,R.textContent=g.language.languages[h],rt.appendChild(R),h===m.lang&&(R.selected=!0)}ae(m.lang);function nt(t,e=null){let a=document.cookie.split(";");for(let o of a){let[r,i]=o.split("=").map(l=>l.trim());if(r===t)return i}return e}function it(t,e,a){var o="";if(a){var r=new Date;r.setTime(r.getTime()+a*24*60*60*1e3),o="; expires="+r.toUTCString()}document.cookie=t+"="+e+o+"; path=/"}function st(){var t=document.getElementById("languageDropdown");m.lang=t.value,ae(m.lang);for(var e in m)it(e,m[e])}function Le(){for(var t in m)m[t]=nt(t,m[t]);ae(m.lang);for(var e=document.getElementById("languageDropdown"),a=0;a<e.options.length;a++)if(e.options[a].value===m.lang){e.selectedIndex=a;break}}function D(t,e){var a=void 0,o=e.toLowerCase();return o in t?a=t[o]:g.language.fallback in t&&(a=t[g.language.fallback]),a}function ae(t){let e=document.querySelectorAll("[data-label]");e.forEach(function(a){var o=a.getAttribute("data-label");if(o in g.labels){var r=D(g.labels[o],t);a.innerText=r}}),e=document.querySelectorAll("[data-title]"),e.forEach(function(a){var o=a.getAttribute("data-title");if(o in g.labels){var r=D(g.labels[o],t);a.setAttribute("title",r)}}),e=document.querySelectorAll("[data-placeholder]"),e.forEach(function(a){var o=a.getAttribute("data-placeholder");if(o in g.labels){var r=D(g.labels[o],t);a.setAttribute("placeholder",r)}}),e=document.querySelectorAll("[data-catID]"),e.forEach(function(a){var o=a.getAttribute("data-catID");for(const r of A.categories)r.catID==o&&(a.innerText=r[t])})}function lt(t){var e=t.coords,a=oe(e.accuracy);z(),n.setView(new L.LatLng(e.latitude,e.longitude),a),w(D(g.labels.youhere,m.lang))}function Ce(t){var e;for(const a of A.providerKeys)a.providerKeyName==t&&(e=a.providerKeyValue);return e}function k(t,e){var a=new URLSearchParams(window.location.search);a.set(t,e),window.history.pushState({},n.options.BMTitle,`${location.pathname}?${a.toString()}`)}function ct(){return n.options.BMTitle}function w(t){n.options.BMTitle=t,document.getElementById("fTitle").value=t,document.title=`BestMap: ${t}`,n.options.BMHasMarker&&f.setTooltipContent(t),k("t",t)}function S(){return re(n.getBearing())}function G(t){document.getElementById("fRot").value=t,k("rot",t);var e=document.querySelector(".nArrow");e.style.transform=`rotate(${t-90}deg)`,t==0?e.style.display="none":e.style.display="block"}function M(t){document.getElementById("fLat").value=t,k("lat",t)}function C(){var t;return n.options.BMHasMarker?t=f.getLatLng().lat:t=n.getCenter().lat,t}function O(){var t;return n.options.BMHasMarker?t=f.getLatLng().lng:t=n.getCenter().lng,t}function B(t){document.getElementById("fLng").value=t,k("lng",t)}function Z(){return n.getZoom()}function K(t){document.getElementById("fZoom").value=t,k("z",t)}function _(t){t?(f.setTooltipContent(n.options.BMTitle),document.getElementById("btFlipMarker").style.backgroundImage="url('icons/removeMarker.png')"):document.getElementById("btFlipMarker").style.backgroundImage="url('icons/addMarker.png')",k("m",t)}function Oe(t){t?document.getElementById("btMeasure").style.backgroundImage="url('icons/removeMeasure.png')":document.getElementById("btMeasure").style.backgroundImage="url('icons/addMeasure.png')"}function xe(t){t?document.getElementById("btTrack").style.backgroundImage="url('icons/removeTrack.png')":document.getElementById("btTrack").style.backgroundImage="url('icons/addTrack.png')"}function oe(t){var o=18-Math.log(t)/Math.log(10);return o=Math.max(0,Math.min(o,18)),o}function dt(t){var e=t.coords,a=oe(e.accuracy);z(),n.flyTo(new L.LatLng(e.latitude,e.longitude),a),n.once("moveend zoomend",function(){H(e.latitude,e.longitude),w(D(g.labels.youhere,m.lang))})}function pt(t){var e=t.coords,a=oe(e.accuracy);z(),n.flyTo(new L.LatLng(e.latitude,e.longitude),a),n.once("moveend zoomend",function(){H(e.latitude,e.longitude);var o=new Date,r=`QP: ${Pe(o)}`;w(r),U(r,!0,S(),C(),O(),Z(),n.options.BMCurrentLayerKey),Ae()})}function ue(t){t.code==1?console.log("getCurrentPosition Error: Access is denied!"):t.code==2&&console.log("getCurrentPosition Error: Position is unavailable!")}function re(t){var e=(parseInt(t)+720)%360;return parseInt(e)}function ut(t){var e=parseFloat(t);return e>90&&(e=90),e<-90&&(e=-90),e}function mt(t){var e=parseFloat(t);return e>180&&(e=180),e<-180&&(e=-180),e}function gt(t){var e=parseInt(t);return e>n.maxZoom&&(e=n.maxZoom),e<n.minZoom&&(e=n.minZoom),e}function W(t){var e=parseInt(t);isNaN(e)&&(e=0),n.eachLayer(function(a){"isOverlay"in a.options&&(a.options.isOverlay||n.removeLayer(a))}),n.addLayer(ne(e)),Ne(e)}function me(t){var e=parseInt(t);if(!isNaN(e)){var a=!0,o=document.getElementById(`BMOverlay-${e}`),r=o.getElementsByTagName("img")[0];if(n.eachLayer(function(i){i.options.BMKey==e&&(a=!1,n.removeLayer(i),r.style.borderColor="black")}),a)for(const i of Y)i.options.BMKey==e&&(n.addLayer(i),r.style.borderColor=he)}}function ft(){var t=document.getElementById("BM-Overlay-Nav-Panel"),e='<div class="BM-Layer-Nav-Container">';for(const o of Y){var a=`BMOverlay-${o.options.BMKey}`;e+=`<div class="BM-Over-Bt" id="${a}" data-bmkey="${o.options.BMKey}" >
              <img src='layerIcons/${o.options.BMicon}' title='${o.options.BMname}'>
              <div class="BM-Layer-Bt-Name">${o.options.BMname}</div>
            </div>`}e+="</div>",t.innerHTML=e}function yt(){for(var t=document.getElementById("BM-Layer-Nav-Panel"),e=0,a=0;a<v.length;a++){for(var o='<div class="BM-Layer-Nav-Container">',r=v[a].layers,i=0;i<r.length;i++){var l=`BMLayer-${e}`;o+=`<div class="BM-Layer-Bt" id="${l}" data-bmkey="${v[a].layers[i].options.BMKey}" >
              <img src='layerIcons/${r[i].options.BMicon}' title='${v[a].layers[i].options.BMname}'>
              <div class="BM-Layer-Bt-Name">${v[a].layers[i].options.BMname}</div>
            </div>`,e++}o+="</div>";var u=`<div class="BM-Layer-Nav-Category" data-catID="${v[a].catID}"  >${v[a].category}</div>${o}`;t.innerHTML+=u}}function ne(t){var e,a,o=parseInt(t);isNaN(o)&&(o=0);for(var r=0;r<v.length;r++){a=v[r].layers;for(var i=0;i<a.length;i++)r===0&&i===0&&(e=a[i]),a[i].options.BMKey===o&&(e=a[i])}return e}function Ne(t){for(var e=document.querySelectorAll(".BM-Layer-Bt"),a=0;a<e.length;a++){var o=e[a].getElementsByTagName("img")[0];e[a].dataset.bmkey==t?o.style.borderColor=he:o.style.borderColor="black"}document.getElementById("fLayer").value=ne(t).options.BMname,document.getElementById("fLayerID").value=t,k("l",t),n.options.BMCurrentLayerKey=t}function vt(){document.addEventListener("click",function(t){if(t.target.matches(".BM-Layer-Bt img")){var e=t.target.parentNode.dataset.bmkey;W(e)}if(t.target.matches(".BM-Layer-Bt div")){var e=t.target.parentNode.dataset.bmkey;W(e)}},!1)}function ht(){document.addEventListener("click",function(t){if(t.target.matches(".BM-Over-Bt img")){var e=t.target.parentNode.dataset.bmkey;me(e)}if(t.target.matches(".BM-Over-Bt div")){var e=t.target.parentNode.dataset.bmkey;me(e)}},!1)}function F(){return n.options.BMHasMarker?f.getLatLng():n.getCenter()}const Mt=document.querySelector("#btSelFavFile");Mt.addEventListener("change",t=>{if(t.target.files.length==1){const[e]=t.target.files,{name:a,size:o}=e,r=(o/1e3).toFixed(2),i=`${a} (${r}KB)`;document.querySelector("#selectedFavFileName").textContent=i,document.querySelector("#btFavDoUpload").style.display="block"}else document.querySelector("#selectedFavFileName").textContent="",document.querySelector("#btFavDoUpload").style.display="none"});function Bt(){document.getElementById("dlgUpload").style.display="block"}function bt(t){let e=t.target.result,a=JSON.parse(e);var o=document.getElementById("FavTableBody");o.innerHTML="";for(let i=0;i<a.length;i++){var r=a[i];U(r.t,r.m,r.rot,r.lat,r.lng,r.z,r.l)}}function wt(){document.getElementById("dlgUpload").style.display="none"}function Et(){let t=document.getElementById("btSelFavFile");if(!t.value.length)return;let e=new FileReader;e.onload=bt,e.readAsText(t.files[0]),document.getElementById("dlgUpload").style.display="none"}function V(t,e,a){const o=document.createElement("a"),r=new Blob([t],{type:a});o.href=URL.createObjectURL(r),o.download=e,o.click()}function kt(t){var e=T.transaction([b],"readonly"),a=e.objectStore(b),o=a.getAll();o.onsuccess=function(r){var i=r.target.result;console.log("Data read successfully"),t(i)},o.onerror=function(r){console.log("Error reading data: "+r.target.errorCode)}}function De(){kt(function(t){var e;for(e of t)U(e.t,e.m,e.rot,e.lat,e.lng,e.z,e.l);Ke("FavTable",0,!1)})}function It(){var t=T.transaction([b],"readwrite"),e=t.objectStore(b),a=e.clear();a.onsuccess=function(o){console.log("All data deleted successfully")},a.onerror=function(o){console.log("Error deleting all data: "+o.target.errorCode)}}function St(t){var e=T.transaction([b],"readwrite"),a=e.objectStore(b),o=a.add(t);o.onsuccess=function(r){console.log("Data inserted successfully")},o.onerror=function(r){console.log("Error inserting data: "+r.target.errorCode)}}function Ae(){It();for(var t=document.getElementById("FavTableBody"),e=0,a;a=t.rows[e];e++){var o={t:a.dataset.t,m:a.dataset.m,rot:a.dataset.rot,l:a.dataset.l,lat:a.dataset.lat,lng:a.dataset.lng,z:a.dataset.z};St(o)}}function U(t,e,a,o,r,i,l){const d=document.getElementById("FavTableBody").insertRow(0);var y=N(),x=N(),ie=N(),se=N(),ze=N(),le="";le=`
  <tr id="${ze}">
    <td id="${y}" class="BM-Table-Input" contenteditable="true">${t}</td>
    <td id="${x}" class="BM-Table-Icon" ><img src="./icons/favView.png"></td>
    <td id="${ie}" class="BM-Table-Icon"><img src="./icons/favUpdate.png"</td>
    <td id="${se}" class="BM-Table-Icon"><img src="./icons/favDelete.png"</td>
  </tr>`,d.innerHTML=le,d.dataset.m=e,d.dataset.t=t,d.dataset.rot=a,d.dataset.lat=o,d.dataset.lng=r,d.dataset.z=i,d.dataset.l=l,document.getElementById(x).addEventListener("click",function(){var s=this.parentNode.dataset;z(),n.panTo({lng:Number(s.lng),lat:Number(s.lat)}),n.setZoom(s.z),K(s.z),n.setBearing(Number(s.rot)),W(Number(s.l)),n.options.BMTitle=s.t,console.log(`GB: BMHasMarker = ${n.options.BMHasMarker}`),console.log(`GB: theUrlObj = ${JSON.stringify(s)}`),console.log(`GB: theUrlObj m type = ${typeof s.m}`),s.m=="true"&&(H(s.lat,s.lng),_(!0),n.options.BMHasMarke=!0,n.panTo({lng:Number(s.lng),lat:Number(s.lat)})),n.panTo({lng:Number(s.lng),lat:Number(s.lat)}),M(Number(s.lat)),B(Number(s.lng)),w(s.t)}),document.getElementById(ie).addEventListener("click",function(){var s=this.parentNode.dataset;document.getElementById("dlgconfirm").style.display="block",document.getElementById("conQuestion").innerText=`Do you update the saved view for: ${s.t}?`,document.getElementById("btConfNo").addEventListener("click",function(){document.getElementById("dlgconfirm").style.display="none"}),document.getElementById("btConfYes").addEventListener("click",function(){s.m=n.options.BMHasMarker,s.rot=S(),s.lat=C(),s.lng=O(),s.z=Z(),s.l=n.options.BMCurrentLayerKey,document.getElementById("dlgconfirm").style.display="none"})}),document.getElementById(se).addEventListener("click",function(){this.parentNode.remove()}),document.getElementById(y).addEventListener("input",function(s){var q=s.target.innerText;n.options.BMTitle!==q&&w(q),this.parentNode.dataset.t=q})}function Pe(t){const e=d=>d.toString().padStart(2,"0"),a=t.getFullYear(),o=e(t.getMonth()+1),r=e(t.getDate()),i=e(t.getHours()),l=e(t.getMinutes()),u=e(t.getSeconds());return`${a}-${o}-${r} ${i}h${l}m${u}s`}function Tt(){document.getElementById("btGoOSM").addEventListener("click",function(){var t=F(),e=n.getZoom(),a=`https://www.openstreetmap.org/#map=${e}/${t.lat}/${t.lng}`;window.open(a)}),document.getElementById("btGoGoogle").addEventListener("click",function(){var t=F(),e=`https://www.google.com/maps/search/?api=1&query=${t.lat},${t.lng}`;window.open(e)}),document.getElementById("btGoGoogleEarth").addEventListener("click",function(){var t=F(),e=n.getZoom(),a=S(),o=Math.pow(2,20-e)*4096;console.log(`z=${e} d=${o}`);var r=`https://earth.google.com/web/@${t.lat},${t.lng},${o}d,${-a}h`;window.open(r)}),document.getElementById("btGoBing").addEventListener("click",function(){var t=F(),e=n.getZoom(),a=S(),o=-a,r=`https://www.bing.com/maps?cp=${t.lat}~${t.lng}&lvl=${e}&dir=${o}`;console.log(r),window.open(r)}),document.getElementById("btFavAdd").addEventListener("click",function(){var t=new Date,e=`NEW: ${Pe(t)}`;U(e,n.options.BMHasMarker,S(),C(),O(),Z(),n.options.BMCurrentLayerKey)}),document.getElementById("btFavAddQuick").addEventListener("click",function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(pt,ue)}),document.getElementById("btFavSave").addEventListener("click",function(){Ae()}),document.getElementById("btFavUndo").addEventListener("click",function(){var t=document.getElementById("FavTableBody");t.innerHTML="",De()}),document.getElementById("btFavExport").addEventListener("click",function(){for(var t=document.getElementById("FavTableBody"),e=[],a=0,o;o=t.rows[a];a++){var r={t:o.dataset.t,m:o.dataset.m,rot:o.dataset.rot,l:o.dataset.l,lat:o.dataset.lat,lng:o.dataset.lng,z:o.dataset.z};e.push(r)}V(JSON.stringify(e),"BMFavorites.json","text/plain")}),document.getElementById("btFavToGeoJSON").addEventListener("click",function(){for(var t=document.getElementById("FavTableBody"),e="",a=0,o;o=t.rows[a];a++){var r=`{
        "type": "Feature",
        "geometry": {
          "type": "Point",
          "coordinates": [${o.dataset.lng},${o.dataset.lat}]
        },
        "properties": {
          "name": "${o.dataset.t}",
          "rotation": ${o.dataset.rot},
          "tilez" : ${o.dataset.z},
          "layerid" : ${o.dataset.l},
          "hasmarker" : ${o.dataset.m}
        }
      }`;e+=a!=0?`,${r}`:r}var i=`{
      "type": "FeatureCollection",
      "features": [${e}]
    }`;V(i,"BMFavorites.geojson","text/plain")}),document.getElementById("btFavToKML").addEventListener("click",function(){for(var t=document.getElementById("FavTableBody"),e="",a=0,o;o=t.rows[a];a++){var r=`<Placemark>
      <name>${o.dataset.t}</name>
      <Point>
        <coordinates>${o.dataset.lng},${o.dataset.lat},0</coordinates>
      </Point></Placemark>`;e+=r}var i=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2">
  <Document>`,l="</Document></kml>",u=i+e+l;V(u,"BMFavorites.kml","text/plain")}),document.getElementById("btFavImport").addEventListener("click",Bt),document.getElementById("btFavCancelUpload").addEventListener("click",wt),document.getElementById("btFavDoUpload").addEventListener("click",Et),document.getElementById("btFlipMarker").addEventListener("click",function(){xt()}),document.getElementById("btTrack").addEventListener("click",function(){zt()}),document.getElementById("btGoHere").addEventListener("click",function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(dt,ue)}),document.getElementById("shareToClipboard").addEventListener("click",function(){navigator.clipboard.writeText(window.location.href)}),document.getElementById("shareToMail").addEventListener("click",function(){var t=encodeURIComponent(window.location.href),e=encodeURIComponent(n.options.BMTitle),a=`mailto:?subject=${e}&body=${e}%0A${t}`;document.location=a}),document.getElementById("btMeasure").addEventListener("click",function(){Se._toggleMeasure(),n.options.BMHasMeasure=!n.options.BMHasMeasure,Oe(n.options.BMHasMeasure)}),document.getElementById("headFavPlace").addEventListener("click",function(){Ke("FavTable",0,!1)}),document.getElementById("btPrefCancel").addEventListener("click",function(){Le()}),document.getElementById("btPrefSave").addEventListener("click",function(){st()})}function ge(){document.getElementById("btEdit").style.display="inline-block",document.getElementById("btEditSave").style.display="none",document.getElementById("btEditCancel").style.display="none",document.getElementById("fTitle").disabled=!0,document.getElementById("fRot").disabled=!0,document.getElementById("fLat").disabled=!0,document.getElementById("fLng").disabled=!0,document.getElementById("fZoom").disabled=!0}function Lt(){var t,e,a,o,r;document.getElementById("btEdit").addEventListener("click",function(){t=ct(),e=S(),a=C(),o=O(),r=Z(),document.getElementById("btEdit").style.display="none",document.getElementById("btEditSave").style.display="inline-block",document.getElementById("btEditCancel").style.display="inline-block",document.getElementById("fTitle").disabled=!1,document.getElementById("fRot").disabled=!1,document.getElementById("fLat").disabled=!1,document.getElementById("fLng").disabled=!1,document.getElementById("fZoom").disabled=!1}),document.getElementById("btEditSave").addEventListener("click",function(){ge();var i=document.getElementById("fTitle").value;i!=t&&w(i);var l=re(document.getElementById("fRot").value);l!=e&&(n.setBearing(l),G(l));var u=ut(document.getElementById("fLat").value),d=mt(document.getElementById("fLng").value);(u!=a||d!=o)&&(n.panTo(new L.LatLng(u,d),y),u!=a&&M(u),d!=o&&B(d));var y=gt(document.getElementById("fZoom").value);y!=r&&(n.setZoom(y),K(y))}),document.getElementById("btEditCancel").addEventListener("click",function(){ge(),document.getElementById("fTitle").value=t,document.getElementById("fRot").value=e})}function Ct(t){if(console.log(t),Array.isArray(t.results)&&t.results.length>0){var e=t.results[0],a=e.geometry.lat,o=e.geometry.lng;n.panTo(new L.LatLng(a,o),{}),M(a),B(o)}}function Ot(){document.getElementById("fSearch").addEventListener("change",function(){var t=document.getElementById("fSearch").value,e="a1f15d3f6b834c55917fd7e435af418c",a=`https://api.opencagedata.com/geocode/v1/json?q=${t}&key=${e}`;console.log(t),fetch(a).then(o=>o.json()).then(o=>Ct(o))})}function H(t,e){f=new L.Marker([t,e],{draggable:!0}),f.bindTooltip(n.options.BMTitle),f.on("dragend",function(a){var o=f.getLatLng().lat,r=f.getLatLng().lng;M(o),B(r)}),n.addLayer(f),n.options.BMHasMarker=!0,_(!0)}function Ze(){var t=n.getCenter().lat,e=n.getCenter().lng;H(t,e)}function xt(){Nt()?z():Ze()}function Nt(){var t=!1;return n.eachLayer(e=>{e instanceof L.Marker&&(t=!0)}),t}function z(){n.eachLayer(t=>{t instanceof L.Marker&&t.remove()}),n.options.BMHasMarker=!1,_(!1)}function fe(){window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission?window.DeviceMotionEvent.requestPermission().then(t=>{t==="granted"&&window.addEventListener("devicemotion",$)}).catch(console.error):window.DeviceOrientationEvent?window.addEventListener("deviceorientationabsolute",$):console.log("Device motion or orientation is not supported by this browser.")}function $(t){const e=t.alpha;if(e!==null){const a=360-e;ee&&(n.setBearing(a),G(a))}}function Dt(){ee=!0,fe(),setInterval(fe,tt)}function At(){ee=!1,window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission?window.removeEventListener("devicemotion",$):window.DeviceOrientationEvent&&window.removeEventListener("deviceorientationabsolute",$)}function ye(){navigator.geolocation?navigator.geolocation.getCurrentPosition(Pt):console.log("Geolocation is not supported by this browser.")}function Pt(t){var e=t.coords.latitude,a=t.coords.longitude;X&&(M(e),B(a),n.panTo({lng:a,lat:e}))}function Zt(){X=!0,ye(),Te=setInterval(ye,1e4)}function Kt(){X=!1,clearInterval(Te)}function zt(){n.options.BMHasTracker?(L.geotagPhoto.crosshair().removeFrom(n),document.querySelectorAll(".leaflet-geotag-photo-crosshair").forEach(e=>e.remove()),Kt(),At()):(L.geotagPhoto.crosshair().addTo(n).on("input",function(t){this.getCrosshairPoint()}),Zt(),Dt()),n.options.BMHasTracker=!n.options.BMHasTracker,xe(n.options.BMHasTracker)}function Ke(t,e,a=!1){const o=document.getElementById(t),r=o.querySelector("tbody"),i=Array.from(r.getElementsByTagName("tr")),l=o.querySelector("thead tr");i.sort((u,d)=>{const y=u.getElementsByTagName("td")[e].textContent.trim(),x=d.getElementsByTagName("td")[e].textContent.trim();return a?x.localeCompare(y):y.localeCompare(x)}),a&&i.reverse(),r.innerHTML="",i.forEach(u=>r.appendChild(u)),o.querySelector("thead").appendChild(l)}
