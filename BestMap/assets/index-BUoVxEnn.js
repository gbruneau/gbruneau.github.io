import"https://cdn.skypack.dev/leaflet";import"https://cdn.skypack.dev/leaflet-rotate";import"https://cdn.skypack.dev/jquery";import"https://maxwell-ilai.github.io/Leaflet.SidePanel/dist/leaflet-sidepanel.min.js";import"https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.js";import"https://unpkg.com/leaflet-geotag-photo/dist/Leaflet.GeotagPhoto.min.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function a(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=a(o);fetch(o.href,i)}})();const $e=202510301027e-4,Ge=[{catID:"BASE",en:"Base Map",fr:"Carte de base",es:"Mapa base"},{catID:"TOPO",en:"Topography",fr:"Topographie",es:"topográfico"},{catID:"IMGE",en:"Imagery",fr:"Imagerie",es:"Imágenes"},{catID:"TRAN",en:"Transport",fr:"Transport",es:"Transporte"},{catID:"MISC",en:"Miscelaneoud",fr:"Divers",es:"Misceláneas"}],Ue=[{providerKeyName:"Thunderforest",providerKeyValue:"538d4534960f4226bb8ca146e7df3941"},{providerKeyName:"jawg",providerKeyValue:"e9xKxlmCUuPGGQvk3FYwqWWmXgyvomdDUECpkBfjQA1obipCjNRKwWlHd1pYr5K2"},{providerKeyName:"tracestrack",providerKeyValue:"8e2a46ccbd594da9395b97cf521da27a"},{providerKeyName:"stadiamaps",providerKeyValue:"b47c1f97-1372-4024-b0cf-d60b46bb1787"},{providerKeyName:"here",providerKeyValue:"NHG82qG2ayXOLV2PQKbPG1Pbt393JTTJ-oX8KkZMdyw"}],He=JSON.parse('[{"BMKey":0,"catID":"BASE","url":"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","attribution":"OSM Mapnik <a href=\\"http://www.openstreetmap.org/copyright\\"  target=\\"_blank\\" >OpenStreetMap ORG</a>","minZoom":1,"maxZoom":19,"BMname":"Open Street Map","BMicon":"Mapnik.png"},{"BMKey":3,"catID":"BASE","url":"//{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png","attribution":"Map data © <a href=\\"http://openstreetmap.org\\"  target=\\"_blank\\" >OpenStreetMap FR</a> contributors","maxZoom":20,"minZoom":0,"BMname":"OSM France","BMicon":"osmFR.png"},{"BMKey":1,"catID":"BASE","url":"https://tile.jawg.io/4284c312-895e-4aa5-9c79-c8974c53f9d3/{z}/{x}/{y}{r}.png?access-token={key}","keyProvider":"jawg","BMname":"Jawg GB","BMicon":"Jawg_GBMain.png","minZoom":0,"maxZoom":22,"subdomains":"abcd","attribution":"<a href=\\"http://jawg.io\\" title=\\"Tiles Courtesy of Jawg Maps\\" target=\\"_blank\\">&copy; <b>Jawg</b>Maps</a> &copy; <a href=\\"https://www.openstreetmap.org/copyright\\"  target=\\"_blank\\" >OpenStreetMap</a> contributors"},{"BMKey":2,"catID":"BASE","url":"http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}","subdomains":["mt0","mt1","mt2","mt3"],"BMname":"Google Map","BMicon":"GoogleMap.png","attribution":"<a href=\\"https://maps.google.com\\"  target=\\"_blank\\" >google Map</a>","maxZoom":20},{"BMKey":7,"catID":"BASE","url":"https://{s}.tile.thunderforest.com/neighbourhood/{z}/{x}/{y}.png?apikey={key}","attribution":"&copy; <a href=\\"http://www.thunderforest.com/\\"  target=\\"_blank\\" >Thunderforest</a>, &copy; <a href=\\"https://www.openstreetmap.org/copyright\\"  target=\\"_blank\\" >OpenStreetMap</a> contributors","keyProvider":"Thunderforest","maxZoom":22,"BMname":"Thunderforest Neighbourhood","BMicon":"Thunderforest_Neighbourhood.png"},{"BMKey":6,"catID":"BASE","url":"https://server.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}","attribution":"Tiles &copy; Esri &mdash; National Geographic, Esri, DeLorme, NAVTEQ, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, iPCy","BMname":"National Geographic","BMicon":"Esri_NatGeoWorldMap.png"},{"BMKey":5,"catID":"BASE","url":"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}","attribution":"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community","BMname":"ESRI Street","BMicon":"ESRIMap.png"},{"BMKey":4,"catID":"BASE","url":"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png","attribution":"&copy; <a href=\\"https://www.openstreetmap.org/copyright\\">OpenStreetMap</a> contributors, Tiles style by <a href=\\"https://www.hotosm.org/\\" target=\\"_blank\\">Humanitarian OpenStreetMap Team</a> hosted by <a href=\\"https://openstreetmap.fr\\" target=\\"_blank\\">OpenStreetMap France</a>","maxZoom":19,"BMname":"Humanitarian OSM","BMicon":"osmHOT.png"},{"BMKey":25,"catID":"TOPO","url":"https://tile.tracestrack.com/topo_fr/{z}/{x}/{y}.png?key={key}","keyProvider":"tracestrack","BMname":"Tracestack Topo","BMicon":"Tracestrack_Topo.png","attribution":"Data: © <a href=\\"https://www.openstreetmap.org/copyright\\"  target=\\"_blank\\" >OpenStreetMap contributors</a>, <a href=\\"https://worldcover2021.esa.int\\"  target=\\"_blank\\" >ESA WorldCover</a>; Maps © <a href=\\"https://www.tracestrack.com/\\" target=\\"_blank\\" >Tracestrack</a>","minZoom":0,"maxZoom":19},{"BMKey":8,"catID":"TOPO","url":"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png","maxZoom":17,"attribution":"Map data: &copy; <a href=\\"https://www.openstreetmap.org/copyright\\" target=\\"_blank\\" >OpenStreetMap</a> contributors, <a href=\\"http://viewfinderpanoramas.org\\" target=\\"_blank\\" >SRTM</a> | Map style: &copy; <a href=\\"https://opentopomap.org\\" target=\\"_blank\\" >OpenTopoMap</a> (<a href=\\"https://creativecommons.org/licenses/by-sa/3.0/\\" target=\\"_blank\\" >CC-BY-SA</a>)","BMname":"Open Topo Map","BMicon":"OpenTopoMap.png"},{"BMKey":11,"catID":"TOPO","url":"http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}","subdomains":["mt0","mt1","mt2","mt3"],"BMname":"Google Terrain","BMicon":"GoogleTerrain.png","attribution":"<a href=\\"https://maps.google.com\\" target=\\"_blank\\" >google Map</a>"},{"BMKey":12,"catID":"TOPO","url":"https://tiles.stadiamaps.com/tiles/stamen_terrain/{z}/{x}/{y}.{ext}","attribution":"Map tiles by <a href=\\"http://stadiamaps.com\\" target=\\"_blank\\" >Stamen Design</a>, <a href=\\"http://creativecommons.org/licenses/by/3.0\\" target=\\"_blank\\" >CC BY 3.0</a> &mdash; Map data &copy; <a href=\\"https://www.openstreetmap.org/copyright\\" target=\\"_blank\\" >OpenStreetMap</a> contributors","subdomains":"abcd","minZoom":1,"maxZoom":18,"ext":"png","BMname":"Stamen Terrain","BMicon":"Stamen_Terrain.png"},{"BMKey":9,"catID":"TOPO","url":"https://{s}.tile.thunderforest.com/outdoors/{z}/{x}/{y}.png?apikey={key}","attribution":"&copy; <a href=\\"http://www.thunderforest.com/\\" target=\\"_blank\\" >Thunderforest</a>, &copy; <a href=\\"https://www.openstreetmap.org/copyright\\" target=\\"_blank\\" >OpenStreetMap</a> contributors","keyProvider":"Thunderforest","maxZoom":22,"BMname":"Thunderforest Outdoors","BMicon":"Thunderforest_Outdoors.png"},{"BMKey":10,"catID":"TOPO","url":"https://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png?apikey={key}","attribution":"&copy; <a href=\\"http://www.thunderforest.com/\\" target=\\"_blank\\" >Thunderforest</a>, &copy; <a href=\\"https://www.openstreetmap.org/copyright\\" target=\\"_blank\\" >OpenStreetMap</a> contributors","keyProvider":"Thunderforest","maxZoom":22,"BMname":"Thunderforest Landscape","BMicon":"Thunderforest_Landscape.png"},{"BMKey":13,"catID":"TOPO","url":"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}","attribution":"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community","BMname":"ESRI Topo","BMicon":"ESRITopo.png"},{"BMKey":30,"catID":"TOPO","url":"http://sgx.geodatenzentrum.de/wmts_topplus_open/tile/1.0.0/web/default/WEBMERCATOR/{z}/{y}/{x}.png","maxZoom":13,"attribution":"Map data: &copy; <a href=\\"http://www.govdata.de/dl-de/by-2-0\\" target=\\"_blank\\" >dl-de/by-2-0</a>","BMname":"Top Plus","BMicon":"TopPlus.png"},{"BMKey":14,"catID":"IMGE","url":"http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}","subdomains":["mt0","mt1","mt2","mt3"],"BMname":"Google Satellite","BMicon":"GoogleSat.png","minZoom":1,"maxZoom":21,"attribution":"<a href=\\"https://maps.google.com\\" target=\\"_blank\\" >google Map</a>"},{"BMKey":3026,"catID":"IMGE","url":"https://1.aerial.maps.ls.hereapi.com/maptile/2.1/maptile/newest/satellite.day/{z}/{x}/{y}/512/jpg?apiKey={key}","attribution":"Here Map","minZoom":1,"maxZoom":19,"BMname":"Here Satellite","BMicon":"Here_Satellite.jpg","keyProvider":"here"},{"BMKey":15,"catID":"IMGE","url":"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}","BMname":"ESRI Image","BMicon":"ESRIImg.png","minZoom":1,"maxZoom":21,"attribution":"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"},{"BMKey":21,"catID":"TRAN","url":"https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png","attribution":"<a href=\\"https://www.openstreetmap.org/copyright\\" target=\\"_blank\\" >OpenStreetMap</a> contributors &copy; <a href=\\"https://carto.com/attributions\\" target=\\"_blank\\" >CARTO</a>","subdomains":"abcd","maxZoom":20,"BMname":"CartoDB Voyager","BMicon":"CartoDB_VoyagerLabelsUnder.png"},{"BMKey":17,"catID":"TRAN","url":"https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey={key}","attribution":"&copy; <a href=\\"http://www.thunderforest.com/\\" target=\\"_blank\\" >Thunderforest</a>, &copy; <a href=\\"https://www.openstreetmap.org/copyright\\" target=\\"_blank\\" >OpenStreetMap</a> contributors","keyProvider":"Thunderforest","maxZoom":22,"BMname":"Thunderforest Transport","BMicon":"Thunderforest_Transport.png"},{"BMKey":20,"catID":"TRAN","url":"https://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey={key}","attribution":"&copy; <a href=\\"http://www.thunderforest.com/\\" target=\\"_blank\\" >Thunderforest</a>, &copy; <a href=\\"https://www.openstreetmap.org/copyright\\" target=\\"_blank\\" >OpenStreetMap</a> contributors","keyProvider":"Thunderforest","maxZoom":22,"BMname":"Thunderforest Cycle","BMicon":"Thunderforest_OpenCycleMap.png"},{"BMKey":19,"catID":"TRAN","url":"https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png","maxZoom":20,"attribution":"<a href=\\"https://github.com/cyclosm/cyclosm-cartocss-style/releases\\" title=\\"CyclOSM - Open Bicycle render\\" target=\\"_blank\\" >CyclOSM</a> | Map data: &copy; <a href=\\"https://www.openstreetmap.org/copyright\\" target=\\"_blank\\" >OpenStreetMap</a> contributors","BMname":"Cyclo OSM","BMicon":"CyclOSM.png"},{"BMKey":28,"catID":"TRAN","url":"https://tileserver.memomaps.de/tilegen/{z}/{x}/{y}.png","minZoom":0,"maxZoom":18,"BMname":"OPNV Karte","BMicon":"OPNVKarte.png","attribution":"Map <a href=\\"https://memomaps.de/\\">memomaps.de</a> <a href=\\"http://creativecommons.org/licenses/by-sa/2.0/\\" target=\\"_blank\\" >CC-BY-SA</a>, map data &copy; <a href=\\"https://www.openstreetmap.org/copyright\\" target=\\"_blank\\" >OpenStreetMap</a> contributors"},{"BMKey":16,"catID":"TRAN","url":"https://{s}.tile.thunderforest.com/mobile-atlas/{z}/{x}/{y}.png?apikey={key}","attribution":"&copy; <a href=\\"http://www.thunderforest.com/\\" target=\\"_blank\\" >Thunderforest</a>, &copy; <a href=\\"https://www.openstreetmap.org/copyright\\" target=\\"_blank\\" >OpenStreetMap</a> contributors","keyProvider":"Thunderforest","maxZoom":22,"BMname":"Thunderforest Mobile Atlas","BMicon":"Thunderforest_MobileAtlas.png"},{"BMKey":18,"catID":"TRAN","url":"https://{s}.tile.thunderforest.com/transport-dark/{z}/{x}/{y}.png?apikey={key}","attribution":"&copy; <a href=\\"http://www.thunderforest.com/\\" target=\\"_blank\\" >Thunderforest</a>, &copy; <a href=\\"https://www.openstreetmap.org/copyright\\" target=\\"_blank\\" >OpenStreetMap</a> contributors","keyProvider":"Thunderforest","maxZoom":22,"BMname":"Thunderforest Transport Dark","BMicon":"Thunderforest_TransportDark.png"},{"BMKey":27,"catID":"MISC","url":"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png","attribution":"&copy; <a href=\\"https://www.openstreetmap.org/copyright\\" target=\\"_blank\\" >OpenStreetMap</a> contributors &copy; <a href=\\"https://carto.com/attributions\\" target=\\"_blank\\" >CARTO</a>","subdomains":"abcd","minZoom":0,"maxZoom":20,"BMname":"CartoDB Positron","BMicon":"CartoDB_Positron.png"},{"BMKey":23,"catID":"MISC","url":"https://tiles.stadiamaps.com/tiles/stamen_toner_lite/{z}/{x}/{y}{r}.{ext}","BMname":"Stamen Toner Lite","BMicon":"Stamen_TonerLite.png","attribution":"Map tiles by <a href=\\"http://stadiamaps.com\\" target=\\"_blank\\" >Stamen Design</a>, <a href=\\"http://creativecommons.org/licenses/by/3.0\\" target=\\"_blank\\" >CC BY 3.0</a> &mdash; Map data &copy; <a href=\\"https://www.openstreetmap.org/copyright\\" target=\\"_blank\\" >OpenStreetMap</a> contributors","subdomains":"abcd","minZoom":0,"maxZoom":20,"ext":"png"},{"BMKey":29,"catID":"MISC","url":"https://tile.jawg.io/jawg-light/{z}/{x}/{y}{r}.png?access-token={key}","keyProvider":"jawg","BMname":"Jawg Light","BMicon":"JawgLight.png","minZoom":0,"maxZoom":22,"subdomains":"abcd","attribution":"<a href=\\"http://jawg.io\\" target=\\"_blank\\"  title=\\"Tiles Courtesy of Jawg Maps\\" target=\\"_blank\\">&copy; <b>Jawg</b>Maps</a> &copy; <a href=\\"https://www.openstreetmap.org/copyright\\"  target=\\"_blank\\"  >OpenStreetMap</a> contributors"},{"BMKey":31,"catID":"MISC","url":"https://tile.jawg.io/jawg-dark/{z}/{x}/{y}{r}.png?access-token={key}","keyProvider":"jawg","BMname":"Jawg Dark","BMicon":"JawgDark.png","minZoom":0,"maxZoom":22,"subdomains":"abcd","attribution":"<a href=\\"http://jawg.io\\" title=\\"Tiles Courtesy of Jawg Maps\\" target=\\"_blank\\">&copy; <b>Jawg</b>Maps</a> &copy; <a href=\\"https://www.openstreetmap.org/copyright\\"  target=\\"_blank\\"  >OpenStreetMap</a> contributors"},{"BMKey":22,"catID":"MISC","url":"https://{s}.tile.thunderforest.com/pioneer/{z}/{x}/{y}.png?apikey={key}","attribution":"&copy; <a href=\\"http://www.thunderforest.com/\\"  target=\\"_blank\\">Thunderforest</a>, &copy; <a href=\\"https://www.openstreetmap.org/copyright\\"  target=\\"_blank\\"  >OpenStreetMap</a> contributors","keyProvider":"Thunderforest","maxZoom":22,"BMname":"Thunderforest Pioneer","BMicon":"Thunderforest_Pioneer.png"},{"BMKey":24,"catID":"MISC","url":"https://tiles.stadiamaps.com/tiles/stamen_watercolor/{z}/{x}/{y}.{ext}","attribution":"Map tiles by <a href=\\"http://stadiamaps.com\\"  target=\\"_blank\\"  >Stamen Design</a>, <a href=\\"http://creativecommons.org/licenses/by/3.0\\"  target=\\"_blank\\"  >CC BY 3.0</a> &mdash; Map data &copy; <a href=\\"https://www.openstreetmap.org/copyright\\"  target=\\"_blank\\"  >OpenStreetMap</a> contributors","subdomains":"abcd","minZoom":1,"maxZoom":16,"ext":"jpg","BMname":"Stamen Watercolor","BMicon":"Stamen_Watercolor.jpg"}]'),qe=[{BMKey:5e3,url:"https://tile.tracestrack.com/subway-route/{z}/{x}/{y}.png?key={key}",keyProvider:"tracestrack",BMname:"Tracestrack Subway",BMicon:"Tracestrack_Subway.png",attribution:'Data: © <a href="https://www.openstreetmap.org/copyright"  target="_blank"  >OpenStreetMap contributors</a>, <a href="https://worldcover2021.esa.int"  target="_blank"  >ESA WorldCover</a>; Maps © <a href="https://www.tracestrack.com/"  target="_blank"  >Tracestrack</a>',minZoom:8,maxZoom:19},{BMKey:5020,url:"https://tile.tracestrack.com/bus-route/{z}/{x}/{y}.png?key={key}",keyProvider:"tracestrack",BMname:"Tracestrack Bus",BMicon:"Tracestrack_Bus.png",attribution:'Data: © <a href="https://www.openstreetmap.org/copyright"  target="_blank"  >OpenStreetMap contributors</a>, <a href="https://worldcover2021.esa.int"  target="_blank"  >ESA WorldCover</a>; Maps © <a href="https://www.tracestrack.com/"  target="_blank"  >Tracestrack</a>',minZoom:8,maxZoom:19},{BMKey:5030,url:"https://tile.tracestrack.com/train-route/{z}/{x}/{y}.png?key={key}",keyProvider:"tracestrack",BMname:"Tracestrack Train",BMicon:"Tracestrack_Train.png",attribution:'Data: © <a href="https://www.openstreetmap.org/copyright"  target="_blank"  >OpenStreetMap contributors</a>, <a href="https://worldcover2021.esa.int"  target="_blank"  >ESA WorldCover</a>; Maps © <a href="https://www.tracestrack.com/"  target="_blank"  >Tracestrack</a>',minZoom:0,maxZoom:19},{BMKey:5040,url:"https://{s}.tiles.openrailwaymap.org/standard/{z}/{x}/{y}.png",BMname:"Open Railway",BMicon:"OpenRailway.png",minZoom:0,maxZoom:19,attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright"  target="_blank"  >OpenStreetMap</a> contributors | Map style: &copy; <a href="https://www.OpenRailwayMap.org"  target="_blank"  >OpenRailwayMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/"  target="_blank"  >CC-BY-SA</a>)'},{BMKey:5500,url:"https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",BMname:"Open Sea Map",BMicon:"openseamap.png",attribution:'Map data: &copy; <a href="http://www.openseamap.org"  target="_blank"  >OpenSeaMap</a> contributors',minZoom:8},{BMKey:5600,url:"https://tile.tracestrack.com/bicycle-route/{z}/{x}/{y}.png?key={key}",keyProvider:"tracestrack",BMname:"Tracestrack Bike",BMicon:"Tracestrack_Bike.png",attribution:'Data: © <a href="https://www.openstreetmap.org/copyright"  target="_blank"  >OpenStreetMap contributors</a>, <a href="https://worldcover2021.esa.int"  target="_blank"  >ESA WorldCover</a>; Maps © <a href="https://www.tracestrack.com/"  target="_blank"  >Tracestrack</a>',minZoom:8,maxZoom:19},{BMKey:5610,url:"https://tile.waymarkedtrails.org/cycling/{z}/{x}/{y}.png",BMname:"Waymarked Cycling",BMicon:"WaymarkedCycling.png",minZoom:0,maxZoom:18,attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright"  target="_blank"  >OpenStreetMap</a> contributors | Map style: &copy; <a href="https://waymarkedtrails.org"  target="_blank"  >waymarkedtrails.org</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/"  target="_blank"  >CC-BY-SA</a>)'},{BMKey:5650,url:"https://tile.waymarkedtrails.org/slopes/{z}/{x}/{y}.png",BMname:"Waymarked Ski",BMicon:"WaymarkedSki.png",minZoom:4,maxZoom:18,attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright"  target="_blank"  >OpenStreetMap</a> contributors | Map style: &copy; <a href="https://waymarkedtrails.org" target="_blank"  >waymarkedtrails.org</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank"  >CC-BY-SA</a>)'},{BMKey:5700,url:"https://servicesvecto3.mern.gouv.qc.ca/geoserver/ZoneInondable_Pub/ows",BMname:"Québec: Zone Innondables",BMicon:"qcZoneInondable.png",attribution:'<a href="https://mern.gouv.qc.ca" target="_blank"  >MERN Québec</a>',minZoom:6,layerType:1,layers:"ZONE_INONDABLE",style:"",format:"image/png",transparent:!0,continuousworld:!0},{BMKey:5710,url:"https://servicescarto.mern.gouv.qc.ca/pes/services/Territoire/GRHQ_WMS/MapServer/WMSServer",BMname:"Québec: Hydrographie",BMicon:"qcHydrographie.png",attribution:'<a href="https://geoegl.msp.gouv.qc.ca"  target="_blank"  >Gouvernement du Québec</a>',minZoom:13,layerType:1,layers:"Surface [125K - 1]",style:"",format:"image/png",transparent:!0,continuousworld:!0},{BMKey:5800,url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",BMname:"Québec: Élevage",BMicon:"qcElevage.png",attribution:'<a href="https://geoegl.msp.gouv.qc.ca" target="_blank"  >Gouvernement du Québec</a>',minZoom:8,layerType:1,layers:"REQ_ELEVAGE_BETAIL_P,REQ_ABATTOIR_P",version:"1.3.0",CRS:"EPSG:3857",format:"image/png",transparent:!0,continuousworld:!0,styles:"",tiled:!0}],A={categories:Ge,providerKeys:Ue,layers:He,overlays:qe},Je=10,je=46.80960630088855,Ve=-71.21267080307008,We=0,Qe=!1,Ye=25,Xe="New map",E={z:Je,lat:je,lng:Ve,rot:We,m:Qe,l:Ye,t:Xe},et={languages:{en:"English",fr:"Français",es:"Español"},fallback:"en"},tt={youhere:{fr:"Vous êtes ici",en:"You are here",es:"Usted está aquí"},expjson:{fr:"Exporter en JSON",en:"Export to JSON",es:"Exportar a JSON"},impfavfile:{fr:"Importer le fichier des favoris",en:"Import favorites file",es:"Importar archivo de favoritos"},selfav:{en:"Select file",es:"Seleccione Archivo",fr:"Choisir le fichier"},cancel:{en:"Cancel",es:"Cancelar",fr:"Annuler"},upload:{en:"Upload",fr:"Téléverser",es:"Cargar"},confirm:{en:"Confirm",fr:"Confirmer",es:"Confirmar"},yes:{en:"Yes",fr:"Oui",es:"Si"},no:{en:"No",fr:"Non",es:"No"},layerselec:{en:"Map selector",fr:"Sélecteur de carte",es:"Selector de mapa"},overlaysel:{en:"Overlay selector",fr:"Sélecteur couche",es:"Selector de capa"},overlay:{en:"Overlay",fr:"Couche",es:"Capas"},tools:{en:"Tools",fr:"Outils",es:"Herramientas"},favplace:{en:"Favorites places",fr:"Lieux préférés",es:"Lugares favoritos"},aboutbm:{en:"About BestMap",fr:"À propos de BestMap",es:"Acerca de BestMap"},maptools:{en:"Map Tools",fr:"Outils cartographiques",es:"Herramientas de mapa"},search:{en:"Search",fr:"Chercher",es:"Buscar"},addrexample:{en:"99 main street, city, state, country",fr:"99 Rue untel,ville,province,pays",es:"99 Calle 12,ciudad, dept., país"},mapNameExample:{en:"Place name",fr:"Nom du lieu",es:"Topónimo"},pref:{en:"Preferences",fr:"Préférences",es:"Preferencias"},save:{en:"Save",fr:"Sauvegarder",es:"Guardar"},weeelzoom:{en:"SHIFT + Mouse weel to rotate",fr:"MAJ + Molette de la souris pour faire pivoter",es:"MAYÚS + rueda del ratón para girar"},marker:{en:"Marker",fr:"Marqueur",es:"Marcador"},gocurpos:{en:"Go to current position",fr:"Aller à votre position actuel",es:"Ir a tu ubicación actual"},trackpos:{en:"Track position",fr:"Suivre la position",es:"Seguir posición"},measure:{en:"Measure",fr:"Mesurer",es:"Medir"},openin:{en:"Open in",fr:"Ouvrir dans",es:"Abrir en"},favsaved:{en:"Favorite saved places",fr:"Lieux sauvegardés favoris",es:"Lugares guardados favoritos"},savechange:{en:"Save changes",fr:"Sauvegarder les changements",es:"Guardar"},undo:{en:"Undo",fr:"Annuler",es:"Cancelar"},impJSON:{en:"Import BestMap JSON file",fr:"Importer fichier JSON BestMap",es:"Importar archivo JSON de BestMap"},expJSON:{en:"Export to BestMap JSON file",fr:"Exporter vers fichier JSON BestMap",es:"Exportar a archivo JSON de BestMap"},expGeoJSON:{en:"Export to GeoJSON file",fr:"Exporter vers un fichier GeoJSON",es:"CanExportar a archivo GeoJSONcelar"},expKML:{en:"Export to KML file",fr:"Exporter vers un fichier KML",es:"CanExportar a archivo KML"},addviewtofav:{en:"Add current view to favorites",fr:"Ajouter la vue actuels aux favoris",es:"Agregar la vista actual"},addQuicktofav:{en:"Add device position to favorites",fr:"Ajouter la position de l'appareil aux favoris",es:"Añadir la posición del dispositivo a favoritos"},placename:{en:"Place Name",fr:"Nom de lieu",es:"Nombre del lugar geográfico"},place:{en:"Place",fr:"Lieu",es:"Lugar"},golocation:{en:"View the location",fr:"Afficher",es:"Ver lugar"},view:{en:"View",fr:"",es:"Ver"},updateview:{en:"Update URL with current location and view",fr:"Mettre à jour avec l'emplacement et la vue actuel",es:"Actualizar con ubicación y vista actual"},update:{en:"Update",fr:"Mettre à jour",es:"Actualizar"},delplace:{en:"Delete this place",fr:"Supprimer cet endroit",es:"Eliminar este lugar"},delete:{en:"Delete",fr:"Supprimer",es:"Eliminar"},chooselang:{en:"Choose a language:",fr:"Choisissez une langue",es:"Seleccione un idioma:"},author:{en:"Author:",fr:"Auteur:",es:"Autor:"},mapname:{en:"Place Name",fr:"Lieu",es:"Lugar"},basemap:{en:"Base Map:",fr:"Carte de base:",es:"Mapa base:"},lat:{en:"Latitude:",fr:"Latitude:",es:"Latitud:"},lng:{en:"Longitude:",fr:"Longitude:",es:"Longitud:"},zoom:{en:"Zoom:",fr:"Zoom:",es:"Zoom"},bmid:{en:"Base Map ID:",fr:"ID Carte de base:",es:"ID Mapa base"},editcurpos:{en:"Edit Current Position:",fr:"Modifier la vue actuelle:",es:"Editar posición actual"},shareclipboard:{en:"Share to Clipboard:",fr:"Partager dans le presse-papiers ::",es:"Compartir en el portapapeles:"},shareemail:{en:"Share by e-mail:",fr:"Partager par courriel:",es:"Compartir por correo electrónico:"},backtoNorth:{en:"Rotate to north",fr:"Retour au nord",es:"De vuelta al norte"}},f={language:et,labels:tt},p=[];for(let e=0;e<256;++e)p.push((e+256).toString(16).slice(1));function at(e,t=0){return(p[e[t+0]]+p[e[t+1]]+p[e[t+2]]+p[e[t+3]]+"-"+p[e[t+4]]+p[e[t+5]]+"-"+p[e[t+6]]+p[e[t+7]]+"-"+p[e[t+8]]+p[e[t+9]]+"-"+p[e[t+10]]+p[e[t+11]]+p[e[t+12]]+p[e[t+13]]+p[e[t+14]]+p[e[t+15]]).toLowerCase()}let j;const rt=new Uint8Array(16);function ot(){if(!j){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");j=crypto.getRandomValues.bind(crypto)}return j(rt)}const nt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),pe={randomUUID:nt};function it(e,t,a){e=e||{};const r=e.random??e.rng?.()??ot();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,at(r)}function _(e,t,a){return pe.randomUUID&&!e?pe.randomUUID():it(e)}const X={defaultState:0,url:1};var g={lang:"fr"},ue={tile:0,wms:1};Oe();var Me=X.defaultState,Be="hsl(197, 100%, 60%)",st=window.location.search,u=new URLSearchParams(st),ke=u.has("z")==!0?Number(u.get("z")):E.z,we=u.has("lat")==!0?Number(u.get("lat")):E.lat,Ee=u.has("lng")==!0?Number(u.get("lng")):E.lng,Ie=u.has("rot")==!0?Number(u.get("rot")):E.rot,me=u.has("m")==!0?u.get("m").toString()=="true":E.m,Se=u.has("t")==!0?u.get("t"):E.t,Te=u.has("l")==!0?u.get("l"):E.l;const lt=1e3;u.has("lat")==!0&&u.has("lng")==!0&&(Me=X.url);var h=[];for(const e of A.categories){var V={catID:e.catID,category:g.lang=="fr"?e.fr:e.en,layers:[]};for(const t of A.layers)if(t.catID==V.catID){var S=t.url;if(t.keyProvider!==void 0){var P=Ne(t.keyProvider);P!==void 0&&(S=t.url.replace("{key}",P))}var c=L.tileLayer(S,{});t.BMKey!==void 0&&(c.options.BMKey=t.BMKey),t.BMname!==void 0&&(c.options.BMname=t.BMname),t.BMicon!==void 0&&(c.options.BMicon=t.BMicon),t.BMicon!==void 0&&(c.options.BMicon=t.BMicon),t.attribution!==void 0&&(c.options.attribution=t.attribution),t.minZoom!==void 0?c.options.minZoom=t.minZoom:c.options.minZoom=0,t.maxZoom!==void 0?c.options.maxZoom=t.maxZoom:c.options.maxZoom=22,t.subdomains!==void 0&&(c.options.subdomains=t.subdomains),t.ext!==void 0&&(c.options.ext=t.ext),c.options.isOverlay=!1,c.options.pane="tilePane",V.layers.push(c)}h.push(V)}var ee=[];for(const e of A.overlays){var S=e.url;if(e.keyProvider!==void 0){var P=Ne(e.keyProvider);P!==void 0&&(S=e.url.replace("{key}",P))}var ge=ue.tile,W={};for(var b in e)e[b]!==void 0&&(W[b]=e[b]);if(e.layerType!==void 0&&(ge=e.layerType),ge==ue.wms)var c=L.tileLayer.wms(S,W);else var c=L.tileLayer(S,W);c.options.isOverlay=!0,c.options.pane="overlayPane",ee.push(c)}var n=L.map("map",{center:new L.LatLng(we,Ee),zoom:ke,zoomControl:!1,rotate:!0,touchRotate:!0,rotateControl:!1,BMHasMarker:!1,BMTitle:Se,bearing:Ie,attributionControl:!0,BMHasMeasure:!1,BMHasTracker:!1,BMCurrentLayerKey:0}),y={},ct=se(Te);n.addLayer(ct);document.getElementById("buildFld").value=$e;L.control.sidepanel("panelID",{panelPosition:"left",hasTabs:!0,tabsPosition:"top",pushControls:!0,darkMode:!0,startTab:"tab-layer"}).addTo(n);var Le=L.control({position:"topright"});Le.onAdd=function(e){var t=L.DomUtil.create("div","info legend nArrow");return t.setAttribute("data-title","backtoNorth"),t.innerHTML="⟴",t};Le.addTo(n);var dt=document.querySelector(".nArrow");dt.addEventListener("click",function(e){n.setBearing(0)});let Ce=L.control.polylineMeasure({position:"topright",unit:"kilometres",showBearings:!1,clearMeasurementsOnStop:!0,showClearControl:!1,showUnitControl:!1,startCircle:{color:"#000",weight:2,fillColor:"#0f0",fillOpacity:1,radius:6},intermedCircle:{color:"#000",weight:2,fillColor:"#ff0",fillOpacity:1,radius:4},currentCircle:{color:"#000",weight:1,fillColor:"#f0f",fillOpacity:1,radius:3},endCircle:{color:"#000",weight:2,fillColor:"#f00",fillOpacity:1,radius:6},tempLine:{color:"#00f",weight:1},fixedLine:{color:"#00C",weight:3}});Ce.addTo(n);document.querySelector(".polyline-measure-unicode-icon").parentNode.style.display="none";n.on("rotate",function(e){G(ie(n.getBearing()))});n.on("resizeend",function(e){M(x()),B(O()),K(Z())});n.on("zoomend",function(e){K(n.getZoom())});n.on("moveend",function(e){M(x()),B(O())});me?ze():U(me);wt();kt();Et();It();Dt();At();Zt();w(Se);G(Ie);M(we);B(Ee);K(ke);Ae(Te);_e(!1);De(!1);let xe,te=!1,ae=!1;var re=indexedDB.open("BestMapDB",1),C,k="BMFavorite";re.onerror=function(e){console.log("Database error: "+e.target.errorCode)};re.onsuccess=function(e){C=e.target.result,console.log("Database opened successfully"),Pe()};re.onupgradeneeded=function(e){C=e.target.result;var t=C.createObjectStore(k,{keyPath:"t"});t.createIndex("m","m",{unique:!1}),t.createIndex("rot","rot",{unique:!1}),t.createIndex("l","l",{unique:!1}),t.createIndex("lat","lat",{unique:!1}),t.createIndex("lng","lng",{unique:!1}),t.createIndex("z","z",{unique:!1})};document.getElementById("dlgUpload").style.display="none";document.getElementById("dlgconfirm").style.display="none";navigator.geolocation&&Me==X.defaultState&&navigator.geolocation.getCurrentPosition(ft);var pt=document.getElementById("languageDropdown");for(var b in f.language.languages)if(f.language.languages.hasOwnProperty(b)){var R=document.createElement("option");R.value=b,R.textContent=f.language.languages[b],pt.appendChild(R),b===g.lang&&(R.selected=!0)}oe(g.lang);function ut(e,t=null){let a=document.cookie.split(";");for(let r of a){let[o,i]=r.split("=").map(l=>l.trim());if(o===e)return i}return t}function mt(e,t,a){var r="";document.cookie=e+"="+t+r+"; path=/"}function gt(){var e=document.getElementById("languageDropdown");g.lang=e.value,oe(g.lang);for(var t in g)mt(t,g[t])}function Oe(){for(var e in g)g[e]=ut(e,g[e]);oe(g.lang);for(var t=document.getElementById("languageDropdown"),a=0;a<t.options.length;a++)if(t.options[a].value===g.lang){t.selectedIndex=a;break}}function D(e,t){var a=void 0,r=t.toLowerCase();return r in e?a=e[r]:f.language.fallback in e&&(a=e[f.language.fallback]),a}function oe(e){let t=document.querySelectorAll("[data-label]");t.forEach(function(a){var r=a.getAttribute("data-label");if(r in f.labels){var o=D(f.labels[r],e);a.innerText=o}}),t=document.querySelectorAll("[data-title]"),t.forEach(function(a){var r=a.getAttribute("data-title");if(r in f.labels){var o=D(f.labels[r],e);a.setAttribute("title",o)}}),t=document.querySelectorAll("[data-placeholder]"),t.forEach(function(a){var r=a.getAttribute("data-placeholder");if(r in f.labels){var o=D(f.labels[r],e);a.setAttribute("placeholder",o)}}),t=document.querySelectorAll("[data-catID]"),t.forEach(function(a){var r=a.getAttribute("data-catID");for(const o of A.categories)o.catID==r&&(a.innerText=o[e])})}function ft(e){var t=e.coords,a=ne(t.accuracy);z(),n.setView(new L.LatLng(t.latitude,t.longitude),a),w(D(f.labels.youhere,g.lang))}function Ne(e){var t;for(const a of A.providerKeys)a.providerKeyName==e&&(t=a.providerKeyValue);return t}function I(e,t){var a=new URLSearchParams(window.location.search);a.set(e,t),window.history.pushState({},n.options.BMTitle,`${location.pathname}?${a.toString()}`)}function yt(){return n.options.BMTitle}function w(e){n.options.BMTitle=e,document.getElementById("fTitle").value=e,document.title=`BestMap: ${e}`,n.options.BMHasMarker&&y.setTooltipContent(e),I("t",e)}function T(){return ie(n.getBearing())}function G(e){document.getElementById("fRot").value=e,I("rot",e);var t=document.querySelector(".nArrow");t.style.transform=`rotate(${e-90}deg)`,e==0?t.style.display="none":t.style.display="block"}function M(e){document.getElementById("fLat").value=e,I("lat",e)}function x(){var e;return n.options.BMHasMarker?e=y.getLatLng().lat:e=n.getCenter().lat,e}function O(){var e;return n.options.BMHasMarker?e=y.getLatLng().lng:e=n.getCenter().lng,e}function B(e){document.getElementById("fLng").value=e,I("lng",e)}function Z(){return n.getZoom()}function K(e){document.getElementById("fZoom").value=e,I("z",e)}function U(e){e?(y.setTooltipContent(n.options.BMTitle),document.getElementById("btFlipMarker").style.backgroundImage="url('icons/removeMarker.png')"):document.getElementById("btFlipMarker").style.backgroundImage="url('icons/addMarker.png')",I("m",e)}function _e(e){e?document.getElementById("btMeasure").style.backgroundImage="url('icons/removeMeasure.png')":document.getElementById("btMeasure").style.backgroundImage="url('icons/addMeasure.png')"}function De(e){e?document.getElementById("btTrack").style.backgroundImage="url('icons/removeTrack.png')":document.getElementById("btTrack").style.backgroundImage="url('icons/addTrack.png')"}function ne(e){var r=18-Math.log(e)/Math.log(10);return r=Math.max(0,Math.min(r,18)),r}function vt(e){var t=e.coords,a=ne(t.accuracy);z(),n.flyTo(new L.LatLng(t.latitude,t.longitude),a),n.once("moveend zoomend",function(){q(t.latitude,t.longitude),w(D(f.labels.youhere,g.lang))})}function ht(e){var t=e.coords,a=ne(t.accuracy);z(),n.flyTo(new L.LatLng(t.latitude,t.longitude),a),n.once("moveend zoomend",function(){q(t.latitude,t.longitude);var r=new Date,o=`QP: ${Ke(r)}`;w(o),H(o,!0,T(),x(),O(),Z(),n.options.BMCurrentLayerKey),Ze()})}function fe(e){e.code==1?console.log("getCurrentPosition Error: Access is denied!"):e.code==2&&console.log("getCurrentPosition Error: Position is unavailable!")}function ie(e){var t=(parseInt(e)+720)%360;return parseInt(t)}function bt(e){var t=parseFloat(e);return t>90&&(t=90),t<-90&&(t=-90),t}function Mt(e){var t=parseFloat(e);return t>180&&(t=180),t<-180&&(t=-180),t}function Bt(e){var t=parseInt(e);return t>n.maxZoom&&(t=n.maxZoom),t<n.minZoom&&(t=n.minZoom),t}function Y(e){var t=parseInt(e);isNaN(t)&&(t=0),n.eachLayer(function(a){"isOverlay"in a.options&&(a.options.isOverlay||n.removeLayer(a))}),n.addLayer(se(t)),Ae(t)}function ye(e){var t=parseInt(e);if(!isNaN(t)){var a=!0,r=document.getElementById(`BMOverlay-${t}`),o=r.getElementsByTagName("img")[0];if(n.eachLayer(function(i){i.options.BMKey==t&&(a=!1,n.removeLayer(i),o.style.borderColor="black")}),a)for(const i of ee)i.options.BMKey==t&&(n.addLayer(i),o.style.borderColor=Be)}}function kt(){var e=document.getElementById("BM-Overlay-Nav-Panel"),t='<div class="BM-Layer-Nav-Container">';for(const r of ee){var a=`BMOverlay-${r.options.BMKey}`;t+=`<div class="BM-Over-Bt" id="${a}" data-bmkey="${r.options.BMKey}" >
              <img src='layerIcons/${r.options.BMicon}' title='${r.options.BMname}'>
              <div class="BM-Layer-Bt-Name">${r.options.BMname}</div>
            </div>`}t+="</div>",e.innerHTML=t}function wt(){for(var e=document.getElementById("BM-Layer-Nav-Panel"),t=0,a=0;a<h.length;a++){for(var r='<div class="BM-Layer-Nav-Container">',o=h[a].layers,i=0;i<o.length;i++){var l=`BMLayer-${t}`;r+=`<div class="BM-Layer-Bt" id="${l}" data-bmkey="${h[a].layers[i].options.BMKey}" >
              <img src='layerIcons/${o[i].options.BMicon}' title='${h[a].layers[i].options.BMname}'>
              <div class="BM-Layer-Bt-Name">${h[a].layers[i].options.BMname}</div>
            </div>`,t++}r+="</div>";var m=`<div class="BM-Layer-Nav-Category" data-catID="${h[a].catID}"  >${h[a].category}</div>${r}`;e.innerHTML+=m}}function se(e){var t,a,r=parseInt(e);isNaN(r)&&(r=0);for(var o=0;o<h.length;o++){a=h[o].layers;for(var i=0;i<a.length;i++)o===0&&i===0&&(t=a[i]),a[i].options.BMKey===r&&(t=a[i])}return t}function Ae(e){for(var t=document.querySelectorAll(".BM-Layer-Bt"),a=0;a<t.length;a++){var r=t[a].getElementsByTagName("img")[0];t[a].dataset.bmkey==e?r.style.borderColor=Be:r.style.borderColor="black"}document.getElementById("fLayer").value=se(e).options.BMname,document.getElementById("fLayerID").value=e,I("l",e),n.options.BMCurrentLayerKey=e}function Et(){document.addEventListener("click",function(e){if(e.target.matches(".BM-Layer-Bt img")){var t=e.target.parentNode.dataset.bmkey;Y(t)}if(e.target.matches(".BM-Layer-Bt div")){var t=e.target.parentNode.dataset.bmkey;Y(t)}},!1)}function It(){document.addEventListener("click",function(e){if(e.target.matches(".BM-Over-Bt img")){var t=e.target.parentNode.dataset.bmkey;ye(t)}if(e.target.matches(".BM-Over-Bt div")){var t=e.target.parentNode.dataset.bmkey;ye(t)}},!1)}function F(){return n.options.BMHasMarker?y.getLatLng():n.getCenter()}const St=document.querySelector("#btSelFavFile");St.addEventListener("change",e=>{if(e.target.files.length==1){const[t]=e.target.files,{name:a,size:r}=t,o=(r/1e3).toFixed(2),i=`${a} (${o}KB)`;document.querySelector("#selectedFavFileName").textContent=i,document.querySelector("#btFavDoUpload").style.display="block"}else document.querySelector("#selectedFavFileName").textContent="",document.querySelector("#btFavDoUpload").style.display="none"});function Tt(){document.getElementById("dlgUpload").style.display="block"}function Lt(e){let t=e.target.result,a=JSON.parse(t);var r=document.getElementById("FavTableBody");r.innerHTML="";for(let i=0;i<a.length;i++){var o=a[i];H(o.t,o.m,o.rot,o.lat,o.lng,o.z,o.l)}}function Ct(){document.getElementById("dlgUpload").style.display="none"}function xt(){let e=document.getElementById("btSelFavFile");if(!e.value.length)return;let t=new FileReader;t.onload=Lt,t.readAsText(e.files[0]),document.getElementById("dlgUpload").style.display="none"}function Q(e,t,a){const r=document.createElement("a"),o=new Blob([e],{type:a});r.href=URL.createObjectURL(o),r.download=t,r.click()}function Ot(e){var t=C.transaction([k],"readonly"),a=t.objectStore(k),r=a.getAll();r.onsuccess=function(o){var i=o.target.result;console.log("Data read successfully"),e(i)},r.onerror=function(o){console.log("Error reading data: "+o.target.errorCode)}}function Pe(){Ot(function(e){var t;for(t of e)H(t.t,t.m,t.rot,t.lat,t.lng,t.z,t.l);Re("FavTable",0,!1)})}function Nt(){var e=C.transaction([k],"readwrite"),t=e.objectStore(k),a=t.clear();a.onsuccess=function(r){console.log("All data deleted successfully")},a.onerror=function(r){console.log("Error deleting all data: "+r.target.errorCode)}}function _t(e){var t=C.transaction([k],"readwrite"),a=t.objectStore(k),r=a.add(e);r.onsuccess=function(o){console.log("Data inserted successfully")},r.onerror=function(o){console.log("Error inserting data: "+o.target.errorCode)}}function Ze(){Nt();for(var e=document.getElementById("FavTableBody"),t=0,a;a=e.rows[t];t++){var r={t:a.dataset.t,m:a.dataset.m,rot:a.dataset.rot,l:a.dataset.l,lat:a.dataset.lat,lng:a.dataset.lng,z:a.dataset.z};_t(r)}}function H(e,t,a,r,o,i,l){const d=document.getElementById("FavTableBody").insertRow(0);var v=_(),N=_(),le=_(),ce=_(),Fe=_(),de="";de=`
  <tr id="${Fe}">
    <td id="${v}" class="BM-Table-Input" contenteditable="true">${e}</td>
    <td id="${N}" class="BM-Table-Icon" ><img src="./icons/favView.png"></td>
    <td id="${le}" class="BM-Table-Icon"><img src="./icons/favUpdate.png"</td>
    <td id="${ce}" class="BM-Table-Icon"><img src="./icons/favDelete.png"</td>
  </tr>`,d.innerHTML=de,d.dataset.m=t,d.dataset.t=e,d.dataset.rot=a,d.dataset.lat=r,d.dataset.lng=o,d.dataset.z=i,d.dataset.l=l,document.getElementById(N).addEventListener("click",function(){var s=this.parentNode.dataset;z(),n.panTo({lng:Number(s.lng),lat:Number(s.lat)}),n.setZoom(s.z),K(s.z),n.setBearing(Number(s.rot)),Y(Number(s.l)),n.options.BMTitle=s.t,console.log(`GB: BMHasMarker = ${n.options.BMHasMarker}`),console.log(`GB: theUrlObj = ${JSON.stringify(s)}`),console.log(`GB: theUrlObj m type = ${typeof s.m}`),s.m=="true"&&(q(s.lat,s.lng),U(!0),n.options.BMHasMarke=!0,n.panTo({lng:Number(s.lng),lat:Number(s.lat)})),n.panTo({lng:Number(s.lng),lat:Number(s.lat)}),M(Number(s.lat)),B(Number(s.lng)),w(s.t)}),document.getElementById(le).addEventListener("click",function(){var s=this.parentNode.dataset;document.getElementById("dlgconfirm").style.display="block",document.getElementById("conQuestion").innerText=`Do you update the saved view for: ${s.t}?`,document.getElementById("btConfNo").addEventListener("click",function(){document.getElementById("dlgconfirm").style.display="none"}),document.getElementById("btConfYes").addEventListener("click",function(){s.m=n.options.BMHasMarker,s.rot=T(),s.lat=x(),s.lng=O(),s.z=Z(),s.l=n.options.BMCurrentLayerKey,document.getElementById("dlgconfirm").style.display="none"})}),document.getElementById(ce).addEventListener("click",function(){this.parentNode.remove()}),document.getElementById(v).addEventListener("input",function(s){var J=s.target.innerText;n.options.BMTitle!==J&&w(J),this.parentNode.dataset.t=J})}function Ke(e){const t=d=>d.toString().padStart(2,"0"),a=e.getFullYear(),r=t(e.getMonth()+1),o=t(e.getDate()),i=t(e.getHours()),l=t(e.getMinutes()),m=t(e.getSeconds());return`${a}-${r}-${o} ${i}h${l}m${m}s`}function Dt(){document.getElementById("btGoOSM").addEventListener("click",function(){var e=F(),t=n.getZoom(),a=`https://www.openstreetmap.org/#map=${t}/${e.lat}/${e.lng}`;window.open(a)}),document.getElementById("btGoGoogle").addEventListener("click",function(){var e=F(),t=`https://www.google.com/maps/search/?api=1&query=${e.lat},${e.lng}`;window.open(t)}),document.getElementById("btGoGoogleEarth").addEventListener("click",function(){var e=F(),t=n.getZoom(),a=T(),r=Math.pow(2,20-t)*4096;console.log(`z=${t} d=${r}`);var o=`https://earth.google.com/web/@${e.lat},${e.lng},${r}d,${-a}h`;window.open(o)}),document.getElementById("btGoBing").addEventListener("click",function(){var e=F(),t=n.getZoom(),a=T(),r=-a,o=`https://www.bing.com/maps?cp=${e.lat}~${e.lng}&lvl=${t}&dir=${r}`;console.log(o),window.open(o)}),document.getElementById("btFavAdd").addEventListener("click",function(){var e=new Date,t=`NEW: ${Ke(e)}`;H(t,n.options.BMHasMarker,T(),x(),O(),Z(),n.options.BMCurrentLayerKey)}),document.getElementById("btFavAddQuick").addEventListener("click",function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(ht,fe)}),document.getElementById("btFavSave").addEventListener("click",function(){Ze()}),document.getElementById("btFavUndo").addEventListener("click",function(){var e=document.getElementById("FavTableBody");e.innerHTML="",Pe()}),document.getElementById("btFavExport").addEventListener("click",function(){for(var e=document.getElementById("FavTableBody"),t=[],a=0,r;r=e.rows[a];a++){var o={t:r.dataset.t,m:r.dataset.m,rot:r.dataset.rot,l:r.dataset.l,lat:r.dataset.lat,lng:r.dataset.lng,z:r.dataset.z};t.push(o)}Q(JSON.stringify(t),"BMFavorites.json","text/plain")}),document.getElementById("btFavToGeoJSON").addEventListener("click",function(){for(var e=document.getElementById("FavTableBody"),t="",a=0,r;r=e.rows[a];a++){var o=`{
        "type": "Feature",
        "geometry": {
          "type": "Point",
          "coordinates": [${r.dataset.lng},${r.dataset.lat}]
        },
        "properties": {
          "name": "${r.dataset.t}",
          "rotation": ${r.dataset.rot},
          "tilez" : ${r.dataset.z},
          "layerid" : ${r.dataset.l},
          "hasmarker" : ${r.dataset.m}
        }
      }`;t+=a!=0?`,${o}`:o}var i=`{
      "type": "FeatureCollection",
      "features": [${t}]
    }`;Q(i,"BMFavorites.geojson","text/plain")}),document.getElementById("btFavToKML").addEventListener("click",function(){for(var e=document.getElementById("FavTableBody"),t="",a=0,r;r=e.rows[a];a++){var o=`<Placemark>
      <name>${r.dataset.t}</name>
      <Point>
        <coordinates>${r.dataset.lng},${r.dataset.lat},0</coordinates>
      </Point></Placemark>`;t+=o}var i=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2">
  <Document>`,l="</Document></kml>",m=i+t+l;Q(m,"BMFavorites.kml","text/plain")}),document.getElementById("btFavImport").addEventListener("click",Tt),document.getElementById("btFavCancelUpload").addEventListener("click",Ct),document.getElementById("btFavDoUpload").addEventListener("click",xt),document.getElementById("btFlipMarker").addEventListener("click",function(){Kt()}),document.getElementById("btTrack").addEventListener("click",function(){Ht()}),document.getElementById("btGoHere").addEventListener("click",function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(vt,fe)}),document.getElementById("shareToClipboard").addEventListener("click",function(){navigator.clipboard.writeText(window.location.href)}),document.getElementById("shareToMail").addEventListener("click",function(){var e=encodeURIComponent(window.location.href),t=encodeURIComponent(n.options.BMTitle),a=`mailto:?subject=${t}&body=${t}%0A${e}`;document.location=a}),document.getElementById("btMeasure").addEventListener("click",function(){Ce._toggleMeasure(),n.options.BMHasMeasure=!n.options.BMHasMeasure,_e(n.options.BMHasMeasure)}),document.getElementById("headFavPlace").addEventListener("click",function(){Re("FavTable",0,!1)}),document.getElementById("btPrefCancel").addEventListener("click",function(){Oe()}),document.getElementById("btPrefSave").addEventListener("click",function(){gt()})}function ve(){document.getElementById("btEdit").style.display="inline-block",document.getElementById("btEditSave").style.display="none",document.getElementById("btEditCancel").style.display="none",document.getElementById("fTitle").disabled=!0,document.getElementById("fRot").disabled=!0,document.getElementById("fLat").disabled=!0,document.getElementById("fLng").disabled=!0,document.getElementById("fZoom").disabled=!0}function At(){var e,t,a,r,o;document.getElementById("btEdit").addEventListener("click",function(){e=yt(),t=T(),a=x(),r=O(),o=Z(),document.getElementById("btEdit").style.display="none",document.getElementById("btEditSave").style.display="inline-block",document.getElementById("btEditCancel").style.display="inline-block",document.getElementById("fTitle").disabled=!1,document.getElementById("fRot").disabled=!1,document.getElementById("fLat").disabled=!1,document.getElementById("fLng").disabled=!1,document.getElementById("fZoom").disabled=!1}),document.getElementById("btEditSave").addEventListener("click",function(){ve();var i=document.getElementById("fTitle").value;i!=e&&w(i);var l=ie(document.getElementById("fRot").value);l!=t&&(n.setBearing(l),G(l));var m=bt(document.getElementById("fLat").value),d=Mt(document.getElementById("fLng").value);(m!=a||d!=r)&&(n.panTo(new L.LatLng(m,d),v),m!=a&&M(m),d!=r&&B(d));var v=Bt(document.getElementById("fZoom").value);v!=o&&(n.setZoom(v),K(v))}),document.getElementById("btEditCancel").addEventListener("click",function(){ve(),document.getElementById("fTitle").value=e,document.getElementById("fRot").value=t})}function Pt(e){if(console.log(e),Array.isArray(e.results)&&e.results.length>0){var t=e.results[0],a=t.geometry.lat,r=t.geometry.lng;n.panTo(new L.LatLng(a,r),{}),M(a),B(r)}}function Zt(){document.getElementById("fSearch").addEventListener("change",function(){var e=document.getElementById("fSearch").value,t="a1f15d3f6b834c55917fd7e435af418c",a=`https://api.opencagedata.com/geocode/v1/json?q=${e}&key=${t}`;console.log(e),fetch(a).then(r=>r.json()).then(r=>Pt(r))})}function q(e,t){y=new L.Marker([e,t],{draggable:!0}),y.bindTooltip(n.options.BMTitle),y.on("dragend",function(a){var r=y.getLatLng().lat,o=y.getLatLng().lng;M(r),B(o)}),n.addLayer(y),n.options.BMHasMarker=!0,U(!0)}function ze(){var e=n.getCenter().lat,t=n.getCenter().lng;q(e,t)}function Kt(){zt()?z():ze()}function zt(){var e=!1;return n.eachLayer(t=>{t instanceof L.Marker&&(e=!0)}),e}function z(){n.eachLayer(e=>{e instanceof L.Marker&&e.remove()}),n.options.BMHasMarker=!1,U(!1)}function he(){window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission?window.DeviceMotionEvent.requestPermission().then(e=>{e==="granted"&&window.addEventListener("devicemotion",$)}).catch(console.error):window.DeviceOrientationEvent?window.addEventListener("deviceorientationabsolute",$):console.log("Device motion or orientation is not supported by this browser.")}function $(e){const t=e.alpha;t!==null&&ae&&(n.setBearing(t),G(t))}function Rt(){ae=!0,he(),setInterval(he,lt)}function Ft(){ae=!1,window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission?window.removeEventListener("devicemotion",$):window.DeviceOrientationEvent&&window.removeEventListener("deviceorientationabsolute",$)}function be(){navigator.geolocation?navigator.geolocation.getCurrentPosition($t):console.log("Geolocation is not supported by this browser.")}function $t(e){var t=e.coords.latitude,a=e.coords.longitude;te&&(M(t),B(a),n.panTo({lng:a,lat:t}))}function Gt(){te=!0,be(),xe=setInterval(be,1e4)}function Ut(){te=!1,clearInterval(xe)}function Ht(){n.options.BMHasTracker?(L.geotagPhoto.crosshair().removeFrom(n),document.querySelectorAll(".leaflet-geotag-photo-crosshair").forEach(t=>t.remove()),Ut(),Ft()):(L.geotagPhoto.crosshair().addTo(n).on("input",function(e){this.getCrosshairPoint();var t=document.querySelector(".leaflet-geotag-photo-crosshair img");t.src="./images/crosshair.svg"}),Gt(),Rt()),n.options.BMHasTracker=!n.options.BMHasTracker,De(n.options.BMHasTracker)}function Re(e,t,a=!1){const r=document.getElementById(e),o=r.querySelector("tbody"),i=Array.from(o.getElementsByTagName("tr")),l=r.querySelector("thead tr");i.sort((m,d)=>{const v=m.getElementsByTagName("td")[t].textContent.trim(),N=d.getElementsByTagName("td")[t].textContent.trim();return a?N.localeCompare(v):v.localeCompare(N)}),a&&i.reverse(),o.innerHTML="",i.forEach(m=>o.appendChild(m)),r.querySelector("thead").appendChild(l)}
