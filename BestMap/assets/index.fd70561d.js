import"https://cdn.skypack.dev/leaflet@1.7.1";import"https://cdn.skypack.dev/leaflet-rotate@0.1.4";import"https://cdn.skypack.dev/jquery";import"https://maxwell-ilai.github.io/Leaflet.SidePanel/dist/leaflet-sidepanel.min.js";import"https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.js";import"https://unpkg.com/leaflet-geotag-photo/dist/Leaflet.GeotagPhoto.min.js";const Pe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}};Pe();var Ke=202506271628e-4;const Ze=[{catID:"BASE",en:"Base Map",fr:"Carte de base",es:"Mapa base"},{catID:"TOPO",en:"Topography",fr:"Topographie",es:"topogr\xE1fico"},{catID:"IMGE",en:"Imagery",fr:"Imagerie",es:"Im\xE1genes"},{catID:"TRAN",en:"Transport",fr:"Transport",es:"Transporte"},{catID:"MISC",en:"Miscelaneoud",fr:"Divers",es:"Miscel\xE1neas"}],ze=[{providerKeyName:"Thunderforest",providerKeyValue:"538d4534960f4226bb8ca146e7df3941"},{providerKeyName:"jawg",providerKeyValue:"e9xKxlmCUuPGGQvk3FYwqWWmXgyvomdDUECpkBfjQA1obipCjNRKwWlHd1pYr5K2"},{providerKeyName:"tracestrack",providerKeyValue:"8e2a46ccbd594da9395b97cf521da27a"},{providerKeyName:"stadiamaps",providerKeyValue:"b47c1f97-1372-4024-b0cf-d60b46bb1787"},{providerKeyName:"here",providerKeyValue:"NHG82qG2ayXOLV2PQKbPG1Pbt393JTTJ-oX8KkZMdyw"}],Fe=[{BMKey:0,catID:"BASE",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'OSM Mapnik <a href="http://www.openstreetmap.org/copyright">OpenStreetMap ORG</a>',minZoom:1,maxZoom:19,BMname:"Open Street Map",BMicon:"Mapnik.png"},{BMKey:3,catID:"BASE",url:"//{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",attribution:'Map data \xA9 <a href="http://openstreetmap.org">OpenStreetMap FR</a> contributors',maxZoom:20,minZoom:0,BMname:"OSM France",BMicon:"osmFR.png"},{BMKey:1,catID:"BASE",url:"https://tile.jawg.io/4284c312-895e-4aa5-9c79-c8974c53f9d3/{z}/{x}/{y}{r}.png?access-token={key}",keyProvider:"jawg",BMname:"Jawn GB",BMicon:"Jawg_GBMain.png",minZoom:0,maxZoom:22,subdomains:"abcd",attribution:'<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},{BMKey:2,catID:"BASE",url:"http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",subdomains:["mt0","mt1","mt2","mt3"],BMname:"Google Map",BMicon:"GoogleMap.png",attribution:'<a href="https://maps.google.com">google Map</a>',maxZoom:20},{BMKey:7,catID:"BASE",url:"https://{s}.tile.thunderforest.com/neighbourhood/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Neighbourhood",BMicon:"Thunderforest_Neighbourhood.png"},{BMKey:6,catID:"BASE",url:"https://server.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; National Geographic, Esri, DeLorme, NAVTEQ, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, iPCy",BMname:"National Geographic",BMicon:"Esri_NatGeoWorldMap.png"},{BMKey:5,catID:"BASE",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community",BMname:"ESRI Street",BMicon:"ESRIMap.png"},{BMKey:4,catID:"BASE",url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Tiles style by <a href="https://www.hotosm.org/" target="_blank">Humanitarian OpenStreetMap Team</a> hosted by <a href="https://openstreetmap.fr" target="_blank">OpenStreetMap France</a>',maxZoom:19,BMname:"Humanitarian OSM",BMicon:"osmHOT.png"},{BMKey:25,catID:"TOPO",url:"https://tile.tracestrack.com/topo_fr/{z}/{x}/{y}.png?key={key}",keyProvider:"tracestrack",BMname:"Tracestack Topo",BMicon:"Tracestrack_Topo.png",attribution:'Data: \xA9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>, <a href="https://worldcover2021.esa.int">ESA WorldCover</a>; Maps \xA9 <a href="https://www.tracestrack.com/">Tracestrack</a>',minZoom:0,maxZoom:19},{BMKey:8,catID:"TOPO",url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",maxZoom:17,attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',BMname:"Open Topo Map",BMicon:"OpenTopoMap.png"},{BMKey:11,catID:"TOPO",url:"http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}",subdomains:["mt0","mt1","mt2","mt3"],BMname:"Google Terrain",BMicon:"GoogleTerrain.png",attribution:'<a href="https://maps.google.com">google Map</a>'},{BMKey:12,catID:"TOPO",url:"https://tiles.stadiamaps.com/tiles/stamen_terrain/{z}/{x}/{y}.{ext}",attribution:'Map tiles by <a href="http://stadiamaps.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:1,maxZoom:18,ext:"png",BMname:"Stamen Terrain",BMicon:"Stamen_Terrain.png"},{BMKey:9,catID:"TOPO",url:"https://{s}.tile.thunderforest.com/outdoors/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Outdoors",BMicon:"Thunderforest_Outdoors.png"},{BMKey:10,catID:"TOPO",url:"https://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Landscape",BMicon:"Thunderforest_Landscape.png"},{BMKey:13,catID:"TOPO",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community",BMname:"ESRI Topo",BMicon:"ESRITopo.png"},{BMKey:30,catID:"TOPO",url:"http://sgx.geodatenzentrum.de/wmts_topplus_open/tile/1.0.0/web/default/WEBMERCATOR/{z}/{y}/{x}.png",maxZoom:13,attribution:'Map data: &copy; <a href="http://www.govdata.de/dl-de/by-2-0">dl-de/by-2-0</a>',BMname:"Top Plus",BMicon:"TopPlus.png"},{BMKey:14,catID:"IMGE",url:"http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",subdomains:["mt0","mt1","mt2","mt3"],BMname:"Google Satellite",BMicon:"GoogleSat.png",minZoom:1,maxZoom:21,attribution:'<a href="https://maps.google.com">google Map</a>'},{BMKey:3026,catID:"IMGE",url:"https://1.aerial.maps.ls.hereapi.com/maptile/2.1/maptile/newest/satellite.day/{z}/{x}/{y}/512/jpg?apiKey={key}",attribution:"Here Map",minZoom:1,maxZoom:19,BMname:"Here Satellite",BMicon:"Here_Satellite.jpg",keyProvider:"here"},{BMKey:15,catID:"IMGE",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",BMname:"ESRI Image",BMicon:"ESRIImg.png",minZoom:1,maxZoom:21,attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"},{BMKey:21,catID:"TRAN",url:"https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png",attribution:'<a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:20,BMname:"CartoDB Voyager",BMicon:"CartoDB_VoyagerLabelsUnder.png"},{BMKey:17,catID:"TRAN",url:"https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Transport",BMicon:"Thunderforest_Transport.png"},{BMKey:20,catID:"TRAN",url:"https://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Cycle",BMicon:"Thunderforest_OpenCycleMap.png"},{BMKey:19,catID:"TRAN",url:"https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",maxZoom:20,attribution:'<a href="https://github.com/cyclosm/cyclosm-cartocss-style/releases" title="CyclOSM - Open Bicycle render">CyclOSM</a> | Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',BMname:"Cyclo OSM",BMicon:"CyclOSM.png"},{BMKey:16,catID:"TRAN",url:"https://{s}.tile.thunderforest.com/mobile-atlas/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Mobile Atlas",BMicon:"Thunderforest_MobileAtlas.png"},{BMKey:18,catID:"TRAN",url:"https://{s}.tile.thunderforest.com/transport-dark/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Transport Dark",BMicon:"Thunderforest_TransportDark.png"},{BMKey:27,catID:"MISC",url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",minZoom:0,maxZoom:20,BMname:"CartoDB Positron",BMicon:"CartoDB_Positron.png"},{BMKey:23,catID:"MISC",url:"https://tiles.stadiamaps.com/tiles/stamen_toner_lite/{z}/{x}/{y}{r}.{ext}",BMname:"Stamen Toner Lite",BMicon:"Stamen_TonerLite.png",attribution:'Map tiles by <a href="http://stadiamaps.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:0,maxZoom:20,ext:"png"},{BMKey:22,catID:"MISC",url:"https://{s}.tile.thunderforest.com/pioneer/{z}/{x}/{y}.png?apikey={key}",attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',keyProvider:"Thunderforest",maxZoom:22,BMname:"Thunderforest Pioneer",BMicon:"Thunderforest_Pioneer.png"},{BMKey:24,catID:"MISC",url:"https://tiles.stadiamaps.com/tiles/stamen_watercolor/{z}/{x}/{y}.{ext}",attribution:'Map tiles by <a href="http://stadiamaps.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:1,maxZoom:16,ext:"jpg",BMname:"Stamen Watercolor",BMicon:"Stamen_Watercolor.jpg"}],Re=[{BMKey:5001,url:"https://tile.tracestrack.com/bicycle-route/{z}/{x}/{y}.png?key={key}",keyProvider:"tracestrack",BMname:"Tracestrack Bike",BMicon:"Tracestrack_Bike.png",attribution:'Data: \xA9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>, <a href="https://worldcover2021.esa.int">ESA WorldCover</a>; Maps \xA9 <a href="https://www.tracestrack.com/">Tracestrack</a>',minZoom:8,maxZoom:19},{BMKey:5e3,url:"https://tile.tracestrack.com/subway-route/{z}/{x}/{y}.png?key={key}",keyProvider:"tracestrack",BMname:"Tracestrack Subway",BMicon:"Tracestrack_Subway.png",attribution:'Data: \xA9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>, <a href="https://worldcover2021.esa.int">ESA WorldCover</a>; Maps \xA9 <a href="https://www.tracestrack.com/">Tracestrack</a>',minZoom:8,maxZoom:19},{BMKey:5002,url:"https://tile.tracestrack.com/bus-route/{z}/{x}/{y}.png?key={key}",keyProvider:"tracestrack",BMname:"Tracestrack Bus",BMicon:"Tracestrack_Bus.png",attribution:'Data: \xA9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>, <a href="https://worldcover2021.esa.int">ESA WorldCover</a>; Maps \xA9 <a href="https://www.tracestrack.com/">Tracestrack</a>',minZoom:8,maxZoom:19},{BMKey:5003,url:"https://tile.tracestrack.com/train-route/{z}/{x}/{y}.png?key={key}",keyProvider:"tracestrack",BMname:"Tracestrack Train",BMicon:"Tracestrack_Train.png",attribution:'Data: \xA9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>, <a href="https://worldcover2021.esa.int">ESA WorldCover</a>; Maps \xA9 <a href="https://www.tracestrack.com/">Tracestrack</a>',minZoom:0,maxZoom:19},{BMKey:5004,url:"https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",BMname:"Open Sea Map",BMicon:"openseamap.png",attribution:'Map data: &copy; <a href="http://www.openseamap.org">OpenSeaMap</a> contributors',minZoom:8},{BMKey:5010,url:"https://servicesvecto3.mern.gouv.qc.ca/geoserver/ZoneInondable_Pub/ows",BMname:"Qu\xE9bec: Zone Innondables",BMicon:"qcZoneInondable.png",attribution:'<a href="https://mern.gouv.qc.ca">MERN Qu\xE9bec</a>',minZoom:6,layerType:1,layers:"ZONE_INONDABLE",style:"",format:"image/png",transparent:!0,continuousworld:!0},{BMKey:5020,url:"https://servicescarto.mern.gouv.qc.ca/pes/services/Territoire/GRHQ_WMS/MapServer/WMSServer",BMname:"Qu\xE9bec: Hydrographie",BMicon:"qcHydrographie.png",attribution:'<a href="https://geoegl.msp.gouv.qc.ca">Gouvernement du Qu\xE9bec</a>',minZoom:13,layerType:1,layers:"Surface [125K - 1]",style:"",format:"image/png",transparent:!0,continuousworld:!0},{BMKey:5030,url:"https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi",BMname:"Qu\xE9bec: \xC9levage",BMicon:"qcElevage.png",attribution:'<a href="https://geoegl.msp.gouv.qc.ca">Gouvernement du Qu\xE9bec</a>',minZoom:8,layerType:1,layers:"REQ_ELEVAGE_BETAIL_P,REQ_ABATTOIR_P",version:"1.3.0",CRS:"EPSG:3857",format:"image/png",transparent:!0,continuousworld:!0,styles:"",tiled:!0}];var x={categories:Ze,providerKeys:ze,layers:Fe,overlays:Re};const Ge=10,$e=46.80960630088855,Ue=-71.21267080307008,_e=0,He=!1,qe=25,Je="New map";var E={z:Ge,lat:$e,lng:Ue,rot:_e,m:He,l:qe,t:Je};const Ve={languages:{en:"English",fr:"Fran\xE7ais",es:"Espa\xF1ol"},fallback:"en"},je={youhere:{fr:"Vous \xEAtes ici",en:"You are here",es:"Usted est\xE1 aqu\xED"},expjson:{fr:"Exporter en JSON",en:"Export to JSON",es:"Exportar a JSON"},impfavfile:{fr:"Importer le fichier des favoris",en:"Import favorites file",es:"Importar archivo de favoritos"},selfav:{en:"Select file",es:"Seleccione Archivo",fr:"Choisir le fichier"},cancel:{en:"Cancel",es:"Cancelar",fr:"Annuler"},upload:{en:"Upload",fr:"T\xE9l\xE9verser",es:"Cargar"},confirm:{en:"Confirm",fr:"Confirmer",es:"Confirmar"},yes:{en:"Yes",fr:"Oui",es:"Si"},no:{en:"No",fr:"Non",es:"No"},layerselec:{en:"Map selector",fr:"S\xE9lecteur de carte",es:"Selector de mapa"},overlaysel:{en:"Overlay selector",fr:"S\xE9lecteur couche",es:"Selector de capa"},overlay:{en:"Overlay",fr:"Couche",es:"Capas"},tools:{en:"Tools",fr:"Outils",es:"Herramientas"},favplace:{en:"Favorites places",fr:"Lieux pr\xE9f\xE9r\xE9s",es:"Lugares favoritos"},aboutbm:{en:"About BestMap",fr:"\xC0 propos de BestMap",es:"Acerca de BestMap"},maptools:{en:"Map Tools",fr:"Outils cartographiques",es:"Herramientas de mapa"},search:{en:"Search",fr:"Chercher",es:"Buscar"},addrexample:{en:"99 main street, city, state, country",fr:"99 Rue untel,ville,province,pays",es:"99 Calle 12,ciudad, dept., pa\xEDs"},mapNameExample:{en:"Place name",fr:"Nom du lieu",es:"Top\xF3nimo"},pref:{en:"Preferences",fr:"Pr\xE9f\xE9rences",es:"Preferencias"},save:{en:"Save",fr:"Sauvegarder",es:"Guardar"},weeelzoom:{en:"SHIFT + Mouse weel to rotate",fr:"MAJ + Molette de la souris pour faire pivoter",es:"MAY\xDAS + rueda del rat\xF3n para girar"},marker:{en:"Marker",fr:"Marqueur",es:"Marcador"},gocurpos:{en:"Go to current position",fr:"Aller \xE0 votre position actuel",es:"Ir a tu ubicaci\xF3n actual"},trackpos:{en:"Track position",fr:"Suivre la position",es:"Seguir posici\xF3n"},measure:{en:"Measure",fr:"Mesurer",es:"Medir"},openin:{en:"Open in",fr:"Ouvrir dans",es:"Abrir en"},favsaved:{en:"Favorite saved places",fr:"Lieux sauvegard\xE9s favoris",es:"Lugares guardados favoritos"},savechange:{en:"Save changes",fr:"Sauvegarder les changements",es:"Guardar"},undo:{en:"Undo",fr:"Annuler",es:"Cancelar"},impJSON:{en:"Import BestMap JSON file",fr:"Importer fichier JSON BestMap",es:"Importar archivo JSON de BestMap"},expJSON:{en:"Export to BestMap JSON file",fr:"Exporter vers fichier JSON BestMap",es:"Exportar a archivo JSON de BestMap"},expGeoJSON:{en:"Export to GeoJSON file",fr:"Exporter vers un fichier GeoJSON",es:"CanExportar a archivo GeoJSONcelar"},expKML:{en:"Export to KML file",fr:"Exporter vers un fichier KML",es:"CanExportar a archivo KML"},addviewtofav:{en:"Add current place and view",fr:"Ajouter le lieu et la vue actuels",es:"Agregar lugar y vista actual"},placename:{en:"Place Name",fr:"Nom de lieu",es:"Nombre del lugar geogr\xE1fico"},place:{en:"Place",fr:"Lieu",es:"Lugar"},golocation:{en:"View the location",fr:"Afficher",es:"Ver lugar"},view:{en:"View",fr:"",es:"Ver"},updateview:{en:"Update URL with current location and view",fr:"Mettre \xE0 jour avec l'emplacement et la vue actuel",es:"Actualizar con ubicaci\xF3n y vista actual"},update:{en:"Update",fr:"Mettre \xE0 jour",es:"Actualizar"},delplace:{en:"Delete this place",fr:"Supprimer cet endroit",es:"Eliminar este lugar"},delete:{en:"Delete",fr:"Supprimer",es:"Eliminar"},chooselang:{en:"Choose a language:",fr:"Choisissez une langue",es:"Seleccione un idioma:"},author:{en:"Author:",fr:"Auteur:",es:"Autor:"},mapname:{en:"Place Name",fr:"Lieu",es:"Lugar"},basemap:{en:"Base Map:",fr:"Carte de base:",es:"Mapa base:"},lat:{en:"Latitude:",fr:"Latitude:",es:"Latitud:"},lng:{en:"Longitude:",fr:"Longitude:",es:"Longitud:"},zoom:{en:"Zoom:",fr:"Zoom:",es:"Zoom"},bmid:{en:"Base Map ID:",fr:"ID Carte de base:",es:"ID Mapa base"},editcurpos:{en:"Edit Current Position:",fr:"Modifier la vue actuelle:",es:"Editar posici\xF3n actual"},shareclipboard:{en:"Share to Clipboard:",fr:"Partager dans le presse-papiers ::",es:"Compartir en el portapapeles:"},shareemail:{en:"Share by e-mail:",fr:"Partager par courriel:",es:"Compartir por correo electr\xF3nico:"},backtoNorth:{en:"Rotate to north",fr:"Retour au nord",es:"De vuelta al norte"}};var g={language:Ve,labels:je};const V={defaultState:0,url:1,device:2};var p={lang:"fr"},se={tile:0,wms:1};Te();var ge=V.defaultState,fe="hsl(197, 100%, 60%)",We=window.location.search,d=new URLSearchParams(We),ye=d.has("z")==!0?Number(d.get("z")):E.z,ve=d.has("lat")==!0?Number(d.get("lat")):E.lat,he=d.has("lng")==!0?Number(d.get("lng")):E.lng,Me=d.has("rot")==!0?Number(d.get("rot")):E.rot,le=d.has("m")==!0?d.get("m").toString()=="true":E.m,Be=d.has("t")==!0?d.get("t"):E.t,be=d.has("l")==!0?d.get("l"):E.l;const Qe=1e3;d.has("lat")==!0&&d.has("lng")==!0&&(ge=V.url);var v=[];for(const e of x.categories){var _={catID:e.catID,category:p.lang=="fr"?e.fr:e.en,layers:[]};for(const t of x.layers)if(t.catID==_.catID){var w=t.url;if(t.keyProvider!==void 0){var N=ke(t.keyProvider);N!==void 0&&(w=t.url.replace("{key}",N))}var l=L.tileLayer(w,{});t.BMKey!==void 0&&(l.options.BMKey=t.BMKey),t.BMname!==void 0&&(l.options.BMname=t.BMname),t.BMicon!==void 0&&(l.options.BMicon=t.BMicon),t.BMicon!==void 0&&(l.options.BMicon=t.BMicon),t.attribution!==void 0&&(l.options.attribution=t.attribution),t.minZoom!==void 0?l.options.minZoom=t.minZoom:l.options.minZoom=0,t.maxZoom!==void 0?l.options.maxZoom=t.maxZoom:l.options.maxZoom=22,t.subdomains!==void 0&&(l.options.subdomains=t.subdomains),t.ext!==void 0&&(l.options.ext=t.ext),l.options.isOverlay=!1,l.options.pane="tilePane",_.layers.push(l)}v.push(_)}var j=[];for(const e of x.overlays){var w=e.url;if(e.keyProvider!==void 0){var N=ke(e.keyProvider);N!==void 0&&(w=e.url.replace("{key}",N))}var ce=se.tile,H={};for(var h in e)e[h]!==void 0&&(H[h]=e[h]);if(e.layerType!==void 0&&(ce=e.layerType),ce==se.wms)var l=L.tileLayer.wms(w,H);else var l=L.tileLayer(w,H);l.options.isOverlay=!0,l.options.pane="overlayPane",j.push(l)}var n=L.map("map",{center:new L.LatLng(ve,he),zoom:ye,zoomControl:!1,rotate:!0,touchRotate:!0,rotateControl:!1,BMHasMarker:!1,BMTitle:Be,bearing:Me,attributionControl:!0,BMHasMeasure:!1,BMHasTracker:!1,BMCurrentLayerKey:0}),f={},Ye=te(be);n.addLayer(Ye);document.getElementById("buildFld").value=Ke;L.control.sidepanel("panelID",{panelPosition:"left",hasTabs:!0,tabsPosition:"top",pushControls:!0,darkMode:!0,startTab:"tab-layer"}).addTo(n);var Ee=L.control({position:"topright"});Ee.onAdd=function(e){var t=L.DomUtil.create("div","info legend nArrow");return t.setAttribute("data-title","backtoNorth"),t.innerHTML="\u27F4",t};Ee.addTo(n);var Xe=document.querySelector(".nArrow");Xe.addEventListener("click",function(e){n.setBearing(0)});let Ie=L.control.polylineMeasure({position:"topright",unit:"kilometres",showBearings:!1,clearMeasurementsOnStop:!0,showClearControl:!1,showUnitControl:!1,startCircle:{color:"#000",weight:2,fillColor:"#0f0",fillOpacity:1,radius:6},intermedCircle:{color:"#000",weight:2,fillColor:"#ff0",fillOpacity:1,radius:4},currentCircle:{color:"#000",weight:1,fillColor:"#f0f",fillOpacity:1,radius:3},endCircle:{color:"#000",weight:2,fillColor:"#f00",fillOpacity:1,radius:6},tempLine:{color:"#00f",weight:1},fixedLine:{color:"#00C",weight:3}});Ie.addTo(n);document.querySelector(".polyline-measure-unicode-icon").parentNode.style.display="none";n.on("rotate",function(e){F(ee(n.getBearing()))});n.on("resizeend",function(e){M(D()),B(A()),P(R())});n.on("zoomend",function(e){P(n.getZoom())});n.on("moveend",function(e){M(D()),B(A())});le?Ne():G(le);pt();ut();mt();gt();It();wt();kt();k(Be);F(Me);M(ve);B(he);P(ye);Oe(be);Se(!1);Le(!1);let we,W=!1,Q=!1;var Y=indexedDB.open("BestMapDB",1),T,b="BMFavorite";Y.onerror=function(e){console.log("Database error: "+e.target.errorCode)};Y.onsuccess=function(e){T=e.target.result,console.log("Database opened successfully"),xe()};Y.onupgradeneeded=function(e){T=e.target.result;var t=T.createObjectStore(b,{keyPath:"t"});t.createIndex("m","m",{unique:!1}),t.createIndex("rot","rot",{unique:!1}),t.createIndex("l","l",{unique:!1}),t.createIndex("lat","lat",{unique:!1}),t.createIndex("lng","lng",{unique:!1}),t.createIndex("z","z",{unique:!1})};document.getElementById("dlgUpload").style.display="none";document.getElementById("dlgconfirm").style.display="none";navigator.geolocation&&ge==V.defaultState&&navigator.geolocation.getCurrentPosition(rt);var et=document.getElementById("languageDropdown");for(var h in g.language.languages)if(g.language.languages.hasOwnProperty(h)){var K=document.createElement("option");K.value=h,K.textContent=g.language.languages[h],et.appendChild(K),h===p.lang&&(K.selected=!0)}X(p.lang);function tt(e,t=null){let a=document.cookie.split(";");for(let o of a){let[r,i]=o.split("=").map(c=>c.trim());if(r===e)return i}return t}function at(e,t,a){var o="";if(a){var r=new Date;r.setTime(r.getTime()+a*24*60*60*1e3),o="; expires="+r.toUTCString()}document.cookie=e+"="+t+o+"; path=/"}function ot(){var e=document.getElementById("languageDropdown");p.lang=e.value,X(p.lang);for(var t in p)at(t,p[t])}function Te(){for(var e in p)p[e]=tt(e,p[e]);X(p.lang);for(var t=document.getElementById("languageDropdown"),a=0;a<t.options.length;a++)if(t.options[a].value===p.lang){t.selectedIndex=a;break}}function C(e,t){var a=void 0,o=t.toLowerCase();return o in e?a=e[o]:g.language.fallback in e&&(a=e[g.language.fallback]),a}function X(e){let t=document.querySelectorAll("[data-label]");t.forEach(function(a){var o=a.getAttribute("data-label");if(o in g.labels){var r=C(g.labels[o],e);a.innerText=r}}),t=document.querySelectorAll("[data-title]"),t.forEach(function(a){var o=a.getAttribute("data-title");if(o in g.labels){var r=C(g.labels[o],e);a.setAttribute("title",r)}}),t=document.querySelectorAll("[data-placeholder]"),t.forEach(function(a){var o=a.getAttribute("data-placeholder");if(o in g.labels){var r=C(g.labels[o],e);a.setAttribute("placeholder",r)}}),t=document.querySelectorAll("[data-catID]"),t.forEach(function(a){var o=a.getAttribute("data-catID");for(const r of x.categories)r.catID==o&&(a.innerText=r[e])})}function rt(e){var t=e.coords,a=Ce(t.accuracy);$(),n.setView(new L.LatLng(t.latitude,t.longitude),a),k(C(g.labels.youhere,p.lang))}function ke(e){var t;for(const a of x.providerKeys)a.providerKeyName==e&&(t=a.providerKeyValue);return t}function I(e,t){var a=new URLSearchParams(window.location.search);a.set(e,t),window.history.pushState({},n.options.BMTitle,`${location.pathname}?${a.toString()}`)}function nt(){return n.options.BMTitle}function k(e){n.options.BMTitle=e,document.getElementById("fTitle").value=e,document.title=`BestMap: ${e}`,n.options.BMHasMarker&&f.setTooltipContent(e),I("t",e)}function O(){return ee(n.getBearing())}function F(e){document.getElementById("fRot").value=e,I("rot",e);var t=document.querySelector(".nArrow");t.style.transform=`rotate(${e-90}deg)`,e==0?t.style.display="none":t.style.display="block"}function M(e){document.getElementById("fLat").value=e,I("lat",e)}function D(){var e;return n.options.BMHasMarker?e=f.getLatLng().lat:e=n.getCenter().lat,e}function A(){var e;return n.options.BMHasMarker?e=f.getLatLng().lng:e=n.getCenter().lng,e}function B(e){document.getElementById("fLng").value=e,I("lng",e)}function R(){return n.getZoom()}function P(e){document.getElementById("fZoom").value=e,I("z",e)}function G(e){e?(f.setTooltipContent(n.options.BMTitle),document.getElementById("btFlipMarker").style.backgroundImage="url('icons/removeMarker.png')"):document.getElementById("btFlipMarker").style.backgroundImage="url('icons/addMarker.png')",I("m",e)}function Se(e){e?document.getElementById("btMeasure").style.backgroundImage="url('icons/removeMeasure.png')":document.getElementById("btMeasure").style.backgroundImage="url('icons/addMeasure.png')"}function Le(e){e?document.getElementById("btTrack").style.backgroundImage="url('icons/removeTrack.png')":document.getElementById("btTrack").style.backgroundImage="url('icons/addTrack.png')"}function Ce(e){var o=18-Math.log(e)/Math.log(10);return o=Math.max(0,Math.min(o,18)),o}function it(e){var t=e.coords,a=Ce(t.accuracy);$(),n.flyTo(new L.LatLng(t.latitude,t.longitude),a),n.once("moveend zoomend",function(){oe(t.latitude,t.longitude),k(C(g.labels.youhere,p.lang))})}function st(e){e.code==1?console.log("getCurrentPosition Error: Access is denied!"):e.code==2&&console.log("getCurrentPosition Error: Position is unavailable!")}function ee(e){var t=parseInt(e);return e<0?t=360- -e%360:t=e%360,parseInt(t)}function lt(e){var t=parseFloat(e);return t>90&&(t=90),t<-90&&(t=-90),t}function ct(e){var t=parseFloat(e);return t>180&&(t=180),t<-180&&(t=-180),t}function dt(e){var t=parseInt(e);return t>n.maxZoom&&(t=n.maxZoom),t<n.minZoom&&(t=n.minZoom),t}function J(e){var t=parseInt(e);isNaN(t)&&(t=0),n.eachLayer(function(a){"isOverlay"in a.options&&(a.options.isOverlay||n.removeLayer(a))}),n.addLayer(te(t)),Oe(t)}function de(e){var t=parseInt(e);if(!isNaN(t)){var a=!0,o=document.getElementById(`BMOverlay-${t}`),r=o.getElementsByTagName("img")[0];if(n.eachLayer(function(i){i.options.BMKey==t&&(a=!1,n.removeLayer(i),r.style.borderColor="black")}),a)for(const i of j)i.options.BMKey==t&&(n.addLayer(i),r.style.borderColor=fe)}}function ut(){var e=document.getElementById("BM-Overlay-Nav-Panel"),t='<div class="BM-Layer-Nav-Container">';for(const o of j){var a=`BMOverlay-${o.options.BMKey}`;t+=`<div class="BM-Over-Bt" id="${a}" data-bmkey="${o.options.BMKey}" >
              <img src='layerIcons/${o.options.BMicon}' title='${o.options.BMname}'>
              <div class="BM-Layer-Bt-Name">${o.options.BMname}</div>
            </div>`}t+="</div>",e.innerHTML=t}function pt(){for(var e=document.getElementById("BM-Layer-Nav-Panel"),t=0,a=0;a<v.length;a++){for(var o='<div class="BM-Layer-Nav-Container">',r=v[a].layers,i=0;i<r.length;i++){var c=`BMLayer-${t}`;o+=`<div class="BM-Layer-Bt" id="${c}" data-bmkey="${v[a].layers[i].options.BMKey}" >
              <img src='layerIcons/${r[i].options.BMicon}' title='${v[a].layers[i].options.BMname}'>
              <div class="BM-Layer-Bt-Name">${v[a].layers[i].options.BMname}</div>
            </div>`,t++}o+="</div>";var m=`<div class="BM-Layer-Nav-Category" data-catID="${v[a].catID}"  >${v[a].category}</div>${o}`;e.innerHTML+=m}}function te(e){var t,a,o=parseInt(e);isNaN(o)&&(o=0);for(var r=0;r<v.length;r++){a=v[r].layers;for(var i=0;i<a.length;i++)r===0&&i===0&&(t=a[i]),a[i].options.BMKey===o&&(t=a[i])}return t}function Oe(e){for(var t=document.querySelectorAll(".BM-Layer-Bt"),a=0;a<t.length;a++){var o=t[a].getElementsByTagName("img")[0];t[a].dataset.bmkey==e?o.style.borderColor=fe:o.style.borderColor="black"}document.getElementById("fLayer").value=te(e).options.BMname,document.getElementById("fLayerID").value=e,I("l",e),n.options.BMCurrentLayerKey=e}function mt(){document.addEventListener("click",function(e){if(e.target.matches(".BM-Layer-Bt img")){var t=e.target.parentNode.dataset.bmkey;J(t)}if(e.target.matches(".BM-Layer-Bt div")){var t=e.target.parentNode.dataset.bmkey;J(t)}},!1)}function gt(){document.addEventListener("click",function(e){if(e.target.matches(".BM-Over-Bt img")){var t=e.target.parentNode.dataset.bmkey;de(t)}if(e.target.matches(".BM-Over-Bt div")){var t=e.target.parentNode.dataset.bmkey;de(t)}},!1)}function Z(){return n.options.BMHasMarker?f.getLatLng():n.getCenter()}const ft=document.querySelector("#btSelFavFile");ft.addEventListener("change",e=>{if(e.target.files.length==1){const[t]=e.target.files,{name:a,size:o}=t,r=(o/1e3).toFixed(2),i=`${a} (${r}KB)`;document.querySelector("#selectedFavFileName").textContent=i,document.querySelector("#btFavDoUpload").style.display="block"}else document.querySelector("#selectedFavFileName").textContent="",document.querySelector("#btFavDoUpload").style.display="none"});function yt(){document.getElementById("dlgUpload").style.display="block"}function vt(e){let t=e.target.result,a=JSON.parse(t);var o=document.getElementById("FavTableBody");o.innerHTML="";for(let i=0;i<a.length;i++){var r=a[i];ae(r.t,r.m,r.rot,r.lat,r.lng,r.z,r.l)}}function ht(){document.getElementById("dlgUpload").style.display="none"}function Mt(){let e=document.getElementById("btSelFavFile");if(!e.value.length)return;let t=new FileReader;t.onload=vt,t.readAsText(e.files[0]),document.getElementById("dlgUpload").style.display="none"}function q(e,t,a){const o=document.createElement("a"),r=new Blob([e],{type:a});o.href=URL.createObjectURL(r),o.download=t,o.click()}function Bt(e){var t=T.transaction([b],"readonly"),a=t.objectStore(b),o=a.getAll();o.onsuccess=function(r){var i=r.target.result;console.log("Data read successfully"),e(i)},o.onerror=function(r){console.log("Error reading data: "+r.target.errorCode)}}function xe(){Bt(function(e){var t;for(t of e)ae(t.t,t.m,t.rot,t.lat,t.lng,t.z,t.l);De("FavTable",0,!1)})}function bt(){var e=T.transaction([b],"readwrite"),t=e.objectStore(b),a=t.clear();a.onsuccess=function(o){console.log("All data deleted successfully")},a.onerror=function(o){console.log("Error deleting all data: "+o.target.errorCode)}}function Et(e){var t=T.transaction([b],"readwrite"),a=t.objectStore(b),o=a.add(e);o.onsuccess=function(r){console.log("Data inserted successfully")},o.onerror=function(r){console.log("Error inserting data: "+r.target.errorCode)}}function ae(e,t,a,o,r,i,c){const u=document.getElementById("FavTableBody").insertRow(0);var y=self.crypto.randomUUID(),S=self.crypto.randomUUID(),re=self.crypto.randomUUID(),ne=self.crypto.randomUUID(),Ae=self.crypto.randomUUID(),ie="";ie=`
  <tr id="${Ae}">
    <td id="${y}" class="BM-Table-Input" contenteditable="true">${e}</td>
    <td id="${S}" class="BM-Table-Icon" ><img src="./icons/favView.png"></td>
    <td id="${re}" class="BM-Table-Icon"><img src="./icons/favUpdate.png"</td>
    <td id="${ne}" class="BM-Table-Icon"><img src="./icons/favDelete.png"</td>
  </tr>`,u.innerHTML=ie,u.dataset.m=t,u.dataset.t=e,u.dataset.rot=a,u.dataset.lat=o,u.dataset.lng=r,u.dataset.z=i,u.dataset.l=c,document.getElementById(S).addEventListener("click",function(){var s=this.parentNode.dataset;$(),n.panTo({lng:Number(s.lng),lat:Number(s.lat)}),n.setZoom(s.z),P(s.z),n.setBearing(Number(s.rot)),J(Number(s.l)),n.options.BMTitle=s.t,console.log(`GB: BMHasMarker = ${n.options.BMHasMarker}`),console.log(`GB: theUrlObj = ${JSON.stringify(s)}`),console.log(`GB: theUrlObj m type = ${typeof s.m}`),s.m=="true"&&(oe(s.lat,s.lng),G(!0),n.options.BMHasMarke=!0,n.panTo({lng:Number(s.lng),lat:Number(s.lat)})),n.panTo({lng:Number(s.lng),lat:Number(s.lat)}),M(Number(s.lat)),B(Number(s.lng)),k(s.t)}),document.getElementById(re).addEventListener("click",function(){var s=this.parentNode.dataset;document.getElementById("dlgconfirm").style.display="block",document.getElementById("conQuestion").innerText=`Do you update the saved view for: ${s.t}?`,document.getElementById("btConfNo").addEventListener("click",function(){document.getElementById("dlgconfirm").style.display="none"}),document.getElementById("btConfYes").addEventListener("click",function(){s.m=n.options.BMHasMarker,s.rot=O(),s.lat=D(),s.lng=A(),s.z=R(),s.l=n.options.BMCurrentLayerKey,document.getElementById("dlgconfirm").style.display="none"})}),document.getElementById(ne).addEventListener("click",function(){this.parentNode.remove()}),document.getElementById(y).addEventListener("input",function(s){var U=s.target.innerText;n.options.BMTitle!==U&&k(U),this.parentNode.dataset.t=U})}function It(){document.getElementById("btGoOSM").addEventListener("click",function(){var e=Z(),t=n.getZoom(),a=`https://www.openstreetmap.org/#map=${t}/${e.lat}/${e.lng}`;window.open(a)}),document.getElementById("btGoGoogle").addEventListener("click",function(){var e=Z(),t=`https://www.google.com/maps/search/?api=1&query=${e.lat},${e.lng}`;window.open(t)}),document.getElementById("btGoGoogleEarth").addEventListener("click",function(){var e=Z(),t=n.getZoom(),a=O(),o=Math.pow(2,20-t)*4096;console.log(`z=${t} d=${o}`);var r=`https://earth.google.com/web/@${e.lat},${e.lng},${o}d,${-a}h`;window.open(r)}),document.getElementById("btGoBing").addEventListener("click",function(){var e=Z(),t=n.getZoom(),a=O(),o=-a,r=`https://www.bing.com/maps?cp=${e.lat}~${e.lng}&lvl=${t}&dir=${o}`;console.log(r),window.open(r)}),document.getElementById("btFavAdd").addEventListener("click",function(){ae("*** name ***",n.options.BMHasMarker,O(),D(),A(),R(),n.options.BMCurrentLayerKey)}),document.getElementById("btFavSave").addEventListener("click",function(){bt();for(var e=document.getElementById("FavTableBody"),t=0,a;a=e.rows[t];t++){var o={t:a.dataset.t,m:a.dataset.m,rot:a.dataset.rot,l:a.dataset.l,lat:a.dataset.lat,lng:a.dataset.lng,z:a.dataset.z};Et(o)}}),document.getElementById("btFavUndo").addEventListener("click",function(){var e=document.getElementById("FavTableBody");e.innerHTML="",xe()}),document.getElementById("btFavExport").addEventListener("click",function(){for(var e=document.getElementById("FavTableBody"),t=[],a=0,o;o=e.rows[a];a++){var r={t:o.dataset.t,m:o.dataset.m,rot:o.dataset.rot,l:o.dataset.l,lat:o.dataset.lat,lng:o.dataset.lng,z:o.dataset.z};t.push(r)}q(JSON.stringify(t),"BMFavorites.json","text/plain")}),document.getElementById("btFavToGeoJSON").addEventListener("click",function(){for(var e=document.getElementById("FavTableBody"),t="",a=0,o;o=e.rows[a];a++){var r=`{
        "type": "Feature",
        "geometry": {
          "type": "Point",
          "coordinates": [${o.dataset.lng},${o.dataset.lat}]
        },
        "properties": {
          "name": "${o.dataset.t}",
          "rotation": ${o.dataset.rot},
          "tilez" : ${o.dataset.z},
          "layerid" : ${o.dataset.l},
          "hasmarker" : ${o.dataset.m}
        }
      }`;t+=a!=0?`,${r}`:r}var i=`{
      "type": "FeatureCollection",
      "features": [${t}]
    }`;q(i,"BMFavorites.geojson","text/plain")}),document.getElementById("btFavToKML").addEventListener("click",function(){for(var e=document.getElementById("FavTableBody"),t="",a=0,o;o=e.rows[a];a++){var r=`<Placemark>
      <name>${o.dataset.t}</name>
      <Point>
        <coordinates>${o.dataset.lng},${o.dataset.lat},0</coordinates>
      </Point></Placemark>`;t+=r}var i=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2">
  <Document>`,c="</Document></kml>",m=i+t+c;q(m,"BMFavorites.kml","text/plain")}),document.getElementById("btFavImport").addEventListener("click",yt),document.getElementById("btFavCancelUpload").addEventListener("click",ht),document.getElementById("btFavDoUpload").addEventListener("click",Mt),document.getElementById("btFlipMarker").addEventListener("click",function(){St()}),document.getElementById("btTrack").addEventListener("click",function(){At()}),document.getElementById("btGoHere").addEventListener("click",function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(it,st)}),document.getElementById("shareToClipboard").addEventListener("click",function(){navigator.clipboard.writeText(window.location.href)}),document.getElementById("shareToMail").addEventListener("click",function(){var e=encodeURIComponent(window.location.href),t=encodeURIComponent(n.options.BMTitle),a=`mailto:?subject=${t}&body=${t}%0A${e}`;document.location=a}),document.getElementById("btMeasure").addEventListener("click",function(){Ie._toggleMeasure(),n.options.BMHasMeasure=!n.options.BMHasMeasure,Se(n.options.BMHasMeasure)}),document.getElementById("headFavPlace").addEventListener("click",function(){De("FavTable",0,!1)}),document.getElementById("btPrefCancel").addEventListener("click",function(){Te()}),document.getElementById("btPrefSave").addEventListener("click",function(){ot()})}function ue(){document.getElementById("btEdit").style.display="inline-block",document.getElementById("btEditSave").style.display="none",document.getElementById("btEditCancel").style.display="none",document.getElementById("fTitle").disabled=!0,document.getElementById("fRot").disabled=!0,document.getElementById("fLat").disabled=!0,document.getElementById("fLng").disabled=!0,document.getElementById("fZoom").disabled=!0}function wt(){var e,t,a,o,r;document.getElementById("btEdit").addEventListener("click",function(){e=nt(),t=O(),a=D(),o=A(),r=R(),document.getElementById("btEdit").style.display="none",document.getElementById("btEditSave").style.display="inline-block",document.getElementById("btEditCancel").style.display="inline-block",document.getElementById("fTitle").disabled=!1,document.getElementById("fRot").disabled=!1,document.getElementById("fLat").disabled=!1,document.getElementById("fLng").disabled=!1,document.getElementById("fZoom").disabled=!1}),document.getElementById("btEditSave").addEventListener("click",function(){ue();var i=document.getElementById("fTitle").value;i!=e&&k(i);var c=ee(document.getElementById("fRot").value);c!=t&&(n.setBearing(c),F(c));var m=lt(document.getElementById("fLat").value),u=ct(document.getElementById("fLng").value);(m!=a||u!=o)&&(n.panTo(new L.LatLng(m,u),y),m!=a&&M(m),u!=o&&B(u));var y=dt(document.getElementById("fZoom").value);y!=r&&(n.setZoom(y),P(y))}),document.getElementById("btEditCancel").addEventListener("click",function(){ue(),document.getElementById("fTitle").value=e,document.getElementById("fRot").value=t})}function Tt(e){if(console.log(e),Array.isArray(e.results)&&e.results.length>0){var t=e.results[0],a=t.geometry.lat,o=t.geometry.lng;n.panTo(new L.LatLng(a,o),{}),M(a),B(o)}}function kt(){document.getElementById("fSearch").addEventListener("change",function(){var e=document.getElementById("fSearch").value,t="a1f15d3f6b834c55917fd7e435af418c",a=`https://api.opencagedata.com/geocode/v1/json?q=${e}&key=${t}`;console.log(e),fetch(a).then(o=>o.json()).then(o=>Tt(o))})}function oe(e,t){f=new L.Marker([e,t],{draggable:!0}),f.bindTooltip(n.options.BMTitle),f.on("dragend",function(a){var o=f.getLatLng().lat,r=f.getLatLng().lng;M(o),B(r)}),n.addLayer(f),n.options.BMHasMarker=!0,G(!0)}function Ne(){var e=n.getCenter().lat,t=n.getCenter().lng;oe(e,t)}function St(){Lt()?$():Ne()}function Lt(){var e=!1;return n.eachLayer(t=>{t instanceof L.Marker&&(e=!0)}),e}function $(){n.eachLayer(e=>{e instanceof L.Marker&&e.remove()}),n.options.BMHasMarker=!1,G(!1)}function pe(){window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission?window.DeviceMotionEvent.requestPermission().then(e=>{e==="granted"&&window.addEventListener("devicemotion",z)}).catch(console.error):window.DeviceOrientationEvent?window.addEventListener("deviceorientationabsolute",z):console.log("Device motion or orientation is not supported by this browser.")}function z(e){let t=null;if(e.rotationRate?t=e.rotationRate.alpha:e.alpha&&(t=e.alpha),t!==null){const a=t;Q&&(n.setBearing(a),F(a))}}function Ct(){Q=!0,pe(),setInterval(pe,Qe)}function Ot(){Q=!1,window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission?window.removeEventListener("devicemotion",z):window.DeviceOrientationEvent&&window.removeEventListener("deviceorientationabsolute",z)}function me(){navigator.geolocation?navigator.geolocation.getCurrentPosition(xt):console.log("Geolocation is not supported by this browser.")}function xt(e){var t=e.coords.latitude,a=e.coords.longitude;W&&(M(t),B(a),n.panTo({lng:a,lat:t}))}function Nt(){W=!0,me(),we=setInterval(me,1e4)}function Dt(){W=!1,clearInterval(we)}function At(){n.options.BMHasTracker?(L.geotagPhoto.crosshair().removeFrom(n),document.querySelectorAll(".leaflet-geotag-photo-crosshair").forEach(t=>t.remove()),Dt(),Ot()):(L.geotagPhoto.crosshair().addTo(n).on("input",function(e){this.getCrosshairPoint()}),Nt(),Ct()),n.options.BMHasTracker=!n.options.BMHasTracker,Le(n.options.BMHasTracker)}function De(e,t,a=!1){const o=document.getElementById(e),r=o.querySelector("tbody"),i=Array.from(r.getElementsByTagName("tr")),c=o.querySelector("thead tr");i.sort((m,u)=>{const y=m.getElementsByTagName("td")[t].textContent.trim(),S=u.getElementsByTagName("td")[t].textContent.trim();return a?S.localeCompare(y):y.localeCompare(S)}),a&&i.reverse(),r.innerHTML="",i.forEach(m=>r.appendChild(m)),o.querySelector("thead").appendChild(c)}
