import"https://cdn.skypack.dev/leaflet@1.7.1";import"https://cdn.skypack.dev/leaflet-rotate@0.1.4";import"https://cdn.skypack.dev/jquery";import"https://maxwell-ilai.github.io/Leaflet.SidePanel/dist/leaflet-sidepanel.min.js";import"https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.js";import"https://unpkg.com/leaflet-geotag-photo/dist/Leaflet.GeotagPhoto.min.js";const pe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function o(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=o(r);fetch(r.href,i)}};pe();var ue=20240422171e-3,ge="hsl(197, 100%, 60%)",ye=window.location.search,c=new URLSearchParams(ye),j=c.has("z")==!0?Number(c.get("z")):10,J=c.has("lat")==!0?Number(c.get("lat")):46.80960630088855,V=c.has("lng")==!0?Number(c.get("lng")):-71.21267080307008,Y=c.has("rot")==!0?Number(c.get("rot")):0,H=c.has("m")==!0?c.get("m").toString()=="true":!1,Q=c.has("t")==!0?c.get("t"):"New Map";const fe=1e3;var y="538d4534960f4226bb8ca146e7df3941",ve="e9xKxlmCUuPGGQvk3FYwqWWmXgyvomdDUECpkBfjQA1obipCjNRKwWlHd1pYr5K2",he="8e2a46ccbd594da9395b97cf521da27a",Me="//{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",Be='Map data \xA9 <a href="http://openstreetmap.org">OpenStreetMap FR</a> contributors',be=new L.TileLayer(Me,{minZoom:1,maxZoom:20,attribution:Be,BMname:"OSM France",BMicon:"osmFR.png",BMKey:3}),Le="https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",we='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Tiles style by <a href="https://www.hotosm.org/" target="_blank">Humanitarian OpenStreetMap Team</a> hosted by <a href="https://openstreetmap.fr/" target="_blank">OpenStreetMap France</a>',Ee=new L.TileLayer(Le,{minZoom:1,maxZoom:19,attribution:we,BMname:"Humanitarian OSM Team",BMicon:"osmHOT.png",BMKey:4}),Te='OSM Mapnik <a href="http://www.openstreetmap.org/copyright">OpenStreetMap ORG</a>',Ie="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",ke=L.tileLayer(Ie,{maxZoom:19,attribution:Te,BMname:"Open Street Map",BMicon:"Mapnik.png",BMKey:0}),Se=L.tileLayer("https://tiles.stadiamaps.com/tiles/stamen_terrain/{z}/{x}/{y}{r}.{ext}",{attribution:'Map tiles by <a href="http://stadiamaps.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:0,maxZoom:18,ext:"png",BMname:"Stamen Terrain Map",BMicon:"Stamen_Terrain.png",BMKey:12}),Ce=L.tileLayer("https://tiles.stadiamaps.com/tiles/stamen_watercolor/{z}/{x}/{y}.{ext}",{attribution:'Map tiles by <a href="http://stadiamaps.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:1,maxZoom:16,ext:"jpg",BMname:"Stamen Watercolor",BMicon:"Stamen_Watercolor.jpg",BMKey:24}),xe=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; National Geographic, Esri, DeLorme, NAVTEQ, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, iPC",maxZoom:16,BMname:"National Geographic",BMicon:"Esri_NatGeoWorldMap.png",BMKey:6}),Oe=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012",BMname:"ESRI Street",BMicon:"ESRIMap.png",BMKey:5}),Ne=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community",BMname:"ESRI Topo",BMicon:"ESRITopo.png",BMKey:13}),ze=L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17,attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',BMname:"Open Topo Map",BMicon:"OpenTopoMap.png",BMKey:8}),Fe=L.tileLayer("https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",{maxZoom:20,attribution:'<a href="https://github.com/cyclosm/cyclosm-cartocss-style/releases" title="CyclOSM - Open Bicycle render">CyclOSM</a> | Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',BMname:"Cyclo OSM",BMicon:"CyclOSM.png",BMKey:19}),Ue=L.tileLayer("https://{s}.tile.thunderforest.com/outdoors/{z}/{x}/{y}.png?apikey={apikey}",{attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',apikey:y,maxZoom:22,BMname:"Thunderforest Outdoors",BMicon:"Thunderforest_Outdoors.png",BMKey:9}),Ge=L.tileLayer("https://{s}.tile.thunderforest.com/pioneer/{z}/{x}/{y}.png?apikey={apikey}",{attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',apikey:y,maxZoom:22,BMname:"Thunderforest Pioneer",BMicon:"Thunderforest_Pioneer.png",BMKey:22}),De=L.tileLayer("https://{s}.tile.thunderforest.com/neighbourhood/{z}/{x}/{y}.png?apikey={apikey}",{attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',apikey:y,maxZoom:22,BMname:"Thunderforest Neighbourhood",BMicon:"Thunderforest_Neighbourhood.png",BMKey:7}),Re=L.tileLayer("https://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey={apikey}",{attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',apikey:y,maxZoom:22,BMname:"Thunderforest Open Cycle Map",BMicon:"Thunderforest_OpenCycleMap.png",BMKey:20}),_e=L.tileLayer("https://{s}.tile.thunderforest.com/mobile-atlas/{z}/{x}/{y}.png?apikey={apikey}",{attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',apikey:y,maxZoom:22,BMname:"Thunderforest Mobile Atlas",BMicon:"Thunderforest_MobileAtlas.png",BMKey:16}),Ae=L.tileLayer("https://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png?apikey={apikey}",{attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',apikey:y,maxZoom:22,BMname:"Thunderforest Landscape",BMicon:"Thunderforest_Landscape.png",BMKey:10}),Ze=L.tileLayer("https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey={apikey}",{attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',apikey:y,maxZoom:22,BMname:"Thunderforest Transport",BMicon:"Thunderforest_Transport.png",BMKey:17}),$e=L.tileLayer("https://{s}.tile.thunderforest.com/transport-dark/{z}/{x}/{y}.png?apikey={apikey}",{attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',apikey:y,maxZoom:22,BMname:"Thunderforest Transport Dark",BMicon:"Thunderforest_TransportDark.png",BMKey:18}),Ke=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",BMname:"ESRI Image",BMicon:"ESRIImg.png",BMKey:15}),He=L.tileLayer("http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"],BMname:"Google Map",BMicon:"GoogleMap.png",BMKey:2}),Pe=L.tileLayer("http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"],BMname:"Google Satellite",BMicon:"GoogleSat.png",BMKey:14}),qe=L.tileLayer("http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"],BMname:"Google Terrain",BMicon:"GoogleTerrain.png",BMKey:11}),We=L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:20,BMname:"CartoDB Voyager",BMicon:"CartoDB_VoyagerLabelsUnder.png",BMKey:21}),je=L.tileLayer("https://tile.jawg.io/4284c312-895e-4aa5-9c79-c8974c53f9d3/{z}/{x}/{y}{r}.png?access-token={accessToken}",{attribution:'<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',minZoom:0,maxZoom:22,subdomains:"abcd",accessToken:ve,BMname:"Jawn GB",BMicon:"Jawg_GBMain.png",BMKey:1}),Je=L.tileLayer("https://tiles.stadiamaps.com/tiles/stamen_toner_lite/{z}/{x}/{y}{r}.{ext}",{attribution:'Map tiles by <a href="http://stadiamaps.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:0,maxZoom:20,ext:"png",BMname:"Stamen Toner Lite",BMicon:"Stamen_TonerLite.png",BMKey:23}),Ve=L.tileLayer(`https://tile.tracestrack.com/topo_fr/{z}/{x}/{y}.png?key=${he}`,{attribution:'Data: \xA9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>, <a href="https://worldcover2021.esa.int">ESA WorldCover</a>; Maps \xA9 <a href="https://www.tracestrack.com/">Tracestrack</a',minZoom:0,maxZoom:18,BMname:"Tracestack Topo",BMicon:"Tracestrack_Topo.png",BMKey:25}),g=[{category:"Base Map",layers:[ke,je,He,be,Ee,Oe,xe,De]},{category:"Topo",layers:[ze,Ue,Ae,qe,Se,Ve,Ne]},{category:"Imagery",layers:[Pe,Ke]},{category:"Transport",layers:[_e,Ze,$e,Fe,Re,We]},{category:"Miscelaneous",layers:[Ge,Je,Ce]}],a=L.map("map",{center:new L.LatLng(J,V),zoom:j,zoomControl:!1,rotate:!0,touchRotate:!0,rotateControl:!1,BMHasMarker:!1,BMTitle:Q,bearing:Y,attributionControl:!1,BMHasMeasure:!1,BMHasTracker:!1,BMCurrentLayerKey:0}),p={},X=c.has("l")==!0?c.get("l"):0;a.addLayer(_(X));document.getElementById("buildFld").value=ue;L.control.sidepanel("panelID",{panelPosition:"left",hasTabs:!0,tabsPosition:"top",pushControls:!0,darkMode:!0,startTab:"tab-layer"}).addTo(a);var ee=L.control({position:"topright"});ee.onAdd=function(e){var t=L.DomUtil.create("div","info legend nArrow");return t.innerHTML="\u27F4",t};ee.addTo(a);var Ye=document.querySelector(".nArrow");Ye.addEventListener("click",function(e){a.setBearing(0)});let te=L.control.polylineMeasure({position:"topright",unit:"kilometres",showBearings:!1,clearMeasurementsOnStop:!0,showClearControl:!1,showUnitControl:!1,startCircle:{color:"#000",weight:2,fillColor:"#0f0",fillOpacity:1,radius:6},intermedCircle:{color:"#000",weight:2,fillColor:"#ff0",fillOpacity:1,radius:4},currentCircle:{color:"#000",weight:1,fillColor:"#f0f",fillOpacity:1,radius:3},endCircle:{color:"#000",weight:2,fillColor:"#f00",fillOpacity:1,radius:6},tempLine:{color:"#00f",weight:1},fixedLine:{color:"#00C",weight:3}});te.addTo(a);document.querySelector(".polyline-measure-unicode-icon").parentNode.style.display="none";a.on("rotate",function(e){x(R(a.getBearing()))});a.on("resizeend",function(e){f(E()),v(T()),I(O())});a.on("zoomend",function(e){I(a.getZoom())});a.on("moveend",function(e){f(E()),v(T())});H?le():N(H);nt();rt();yt();ft();ht();S(Q);x(Y);f(J);v(V);I(j);re(X);ae(!1);ne(!1);let oe,U=!1,G=!1;var D=indexedDB.open("BestMapDB",1),B,h="BMFavorite";D.onerror=function(e){console.log("Database error: "+e.target.errorCode)};D.onsuccess=function(e){B=e.target.result,console.log("Database opened successfully"),ie()};D.onupgradeneeded=function(e){B=e.target.result;var t=B.createObjectStore(h,{keyPath:"t"});t.createIndex("m","m",{unique:!1}),t.createIndex("rot","rot",{unique:!1}),t.createIndex("l","l",{unique:!1}),t.createIndex("lat","lat",{unique:!1}),t.createIndex("lng","lng",{unique:!1}),t.createIndex("z","z",{unique:!1})};document.getElementById("dlgUpload").style.display="none";document.getElementById("dlgconfirm").style.display="none";function M(e,t){var o=new URLSearchParams(window.location.search);o.set(e,t),window.history.pushState({},a.options.BMTitle,`${location.pathname}?${o.toString()}`)}function Qe(){return a.options.BMTitle}function S(e){a.options.BMTitle=e,document.getElementById("fTitle").value=e,document.title=`BestMap: ${e}`,a.options.BMHasMarker&&p.setTooltipContent(e),M("t",e)}function w(){return R(a.getBearing())}function x(e){document.getElementById("fRot").value=e,M("rot",e);var t=document.querySelector(".nArrow");t.style.transform=`rotate(${e-90}deg)`,e==0?t.style.display="none":t.style.display="block"}function f(e){document.getElementById("fLat").value=e,M("lat",e)}function E(){var e;return a.options.BMHasMarker?e=p.getLatLng().lat:e=a.getCenter().lat,e}function T(){var e;return a.options.BMHasMarker?e=p.getLatLng().lng:e=a.getCenter().lng,e}function v(e){document.getElementById("fLng").value=e,M("lng",e)}function O(){return a.getZoom()}function I(e){document.getElementById("fZoom").value=e,M("z",e)}function N(e){e?(p.setTooltipContent(a.options.BMTitle),document.getElementById("btFlipMarker").style.backgroundImage="url('icons/removeMarker.png')"):document.getElementById("btFlipMarker").style.backgroundImage="url('icons/addMarker.png')",M("m",e)}function ae(e){e?document.getElementById("btMeasure").style.backgroundImage="url('icons/removeMeasure.png')":document.getElementById("btMeasure").style.backgroundImage="url('icons/addMeasure.png')"}function ne(e){e?document.getElementById("btTrack").style.backgroundImage="url('icons/removeTrack.png')":document.getElementById("btTrack").style.backgroundImage="url('icons/addTrack.png')"}function Xe(e){var t=e.coords,o=Math.min(Math.max(Math.ceil(Math.log(t.accuracy)/Math.log(2)),0),20);o=14,a.flyTo(new L.LatLng(t.latitude,t.longitude),o)}function et(e){e.code==1?console.log("getCurrentPosition Error: Access is denied!"):e.code==2&&console.log("getCurrentPosition Error: Position is unavailable!")}function R(e){var t=parseInt(e);return e<0?t=360- -e%360:t=e%360,parseInt(t)}function tt(e){var t=parseFloat(e);return t>90&&(t=90),t<-90&&(t=-90),t}function ot(e){var t=parseFloat(e);return t>180&&(t=180),t<-180&&(t=-180),t}function at(e){var t=parseInt(e);return t>a.maxZoom&&(t=a.maxZoom),t<a.minZoom&&(t=a.minZoom),t}function F(e){var t=parseInt(e);isNaN(t)&&(t=0),a.eachLayer(function(o){"BMname"in o.options&&a.removeLayer(o)}),a.addLayer(_(t)),re(t)}function nt(){for(var e=document.getElementById("BM-Layer-Nav-Panel"),t=0,o=0;o<g.length;o++){for(var n='<div class="BM-Layer-Nav-Container">',r=g[o].layers,i=0;i<r.length;i++){var d=`BMLayer-${t}`;n+=`<div class="BM-Layer-Bt" id="${d}" data-bmkey="${g[o].layers[i].options.BMKey}" >
              <img src='layerIcons/${r[i].options.BMicon}' title='${g[o].layers[i].options.BMname}'>
              <div class="BM-Layer-Bt-Name">${g[o].layers[i].options.BMname}</div>
            </div>`,t++}n+="</div>";var m=`<div class="BM-Layer-Nav-Category">${g[o].category}</div>${n}`;e.innerHTML+=m}}function _(e){var t,o,n=parseInt(e);isNaN(n)&&(n=0);for(var r=0;r<g.length;r++){o=g[r].layers;for(var i=0;i<o.length;i++)r===0&&i===0&&(t=o[i]),o[i].options.BMKey===n&&(t=o[i])}return t}function re(e){for(var t=document.querySelectorAll(".BM-Layer-Bt"),o=0;o<t.length;o++){var n=t[o].getElementsByTagName("img")[0];t[o].dataset.BMKey==e?n.style.borderColor=ge:n.style.borderColor="black"}document.getElementById("fLayer").value=_(e).options.BMname,document.getElementById("fLayerID").value=e,M("l",e),a.options.BMCurrentLayerKey=e}function rt(){document.addEventListener("click",function(e){if(e.target.matches(".BM-Layer-Bt img")){var t=e.target.parentNode.dataset.bmkey;F(t)}if(e.target.matches(".BM-Layer-Bt div")){var t=e.target.parentNode.dataset.bmkey;F(t)}},!1)}function k(){return a.options.BMHasMarker?p.getLatLng():a.getCenter()}const it=document.querySelector("#btSelFavFile");it.addEventListener("change",e=>{if(e.target.files.length==1){const[t]=e.target.files,{name:o,size:n}=t,r=(n/1e3).toFixed(2),i=`${o} (${r}KB)`;document.querySelector("#selectedFavFileName").textContent=i,document.querySelector("#btFavDoUpload").style.display="block"}else document.querySelector("#selectedFavFileName").textContent="",document.querySelector("#btFavDoUpload").style.display="none"});function st(){document.getElementById("dlgUpload").style.display="block"}function lt(e){let t=e.target.result,o=JSON.parse(t);var n=document.getElementById("FavTableBody");n.innerHTML="";for(let i=0;i<o.length;i++){var r=o[i];A(r.t,r.m,r.rot,r.lat,r.lng,r.z,r.l)}}function ct(){document.getElementById("dlgUpload").style.display="none"}function dt(){let e=document.getElementById("btSelFavFile");if(!e.value.length)return;let t=new FileReader;t.onload=lt,t.readAsText(e.files[0]),document.getElementById("dlgUpload").style.display="none"}function mt(e,t,o){const n=document.createElement("a"),r=new Blob([e],{type:o});n.href=URL.createObjectURL(r),n.download=t,n.click()}function pt(e){var t=B.transaction([h],"readonly"),o=t.objectStore(h),n=o.getAll();n.onsuccess=function(r){var i=r.target.result;console.log("Data read successfully"),e(i)},n.onerror=function(r){console.log("Error reading data: "+r.target.errorCode)}}function ie(){pt(function(e){var t;for(t of e)A(t.t,t.m,t.rot,t.lat,t.lng,t.z,t.l);de("FavTable",0,!1)})}function ut(){var e=B.transaction([h],"readwrite"),t=e.objectStore(h),o=t.clear();o.onsuccess=function(n){console.log("All data deleted successfully")},o.onerror=function(n){console.log("Error deleting all data: "+n.target.errorCode)}}function gt(e){var t=B.transaction([h],"readwrite"),o=t.objectStore(h),n=o.add(e);n.onsuccess=function(r){console.log("Data inserted successfully")},n.onerror=function(r){console.log("Error inserting data: "+r.target.errorCode)}}function A(e,t,o,n,r,i,d){const l=document.getElementById("FavTableBody").insertRow(0);var u=self.crypto.randomUUID(),b=self.crypto.randomUUID(),Z=self.crypto.randomUUID(),$=self.crypto.randomUUID(),me=self.crypto.randomUUID(),K="";K=`
  <tr id="${me}">
    <td id="${u}" class="BM-Table-Input" contenteditable="true">${e}</td>
    <td id="${b}" class="BM-Table-Icon" >\u{1F5FA}</td>
    <td id="${Z}" class="BM-Table-Icon">\u27F3</td>
    <td id="${$}" class="BM-Table-Icon">\u{1F5D1}</td>
  </tr>`,l.innerHTML=K,l.dataset.m=t,l.dataset.t=e,l.dataset.rot=o,l.dataset.lat=n,l.dataset.lng=r,l.dataset.z=i,l.dataset.l=d,document.getElementById(b).addEventListener("click",function(){var s=this.parentNode.dataset;ce(),a.panTo({lng:Number(s.lng),lat:Number(s.lat)}),a.setZoom(s.z),I(s.z),a.setBearing(Number(s.rot)),F(Number(s.l)),a.options.BMTitle=s.t,console.log(`GB: BMHasMarker = ${a.options.BMHasMarker}`),console.log(`GB: theUrlObj = ${JSON.stringify(s)}`),console.log(`GB: theUrlObj m type = ${typeof s.m}`),s.m=="true"&&(se(s.lat,s.lng),N(!0),a.options.BMHasMarke=!0,a.panTo({lng:Number(s.lng),lat:Number(s.lat)})),a.panTo({lng:Number(s.lng),lat:Number(s.lat)}),f(Number(s.lat)),v(Number(s.lng)),S(s.t)}),document.getElementById(Z).addEventListener("click",function(){var s=this.parentNode.dataset;document.getElementById("dlgconfirm").style.display="block",document.getElementById("conQuestion").innerText=`Do you update the saved view for: ${s.t}?`,document.getElementById("btConfNo").addEventListener("click",function(){document.getElementById("dlgconfirm").style.display="none"}),document.getElementById("btConfYes").addEventListener("click",function(){s.m=a.options.BMHasMarker,s.rot=w(),s.lat=E(),s.lng=T(),s.z=O(),s.l=a.options.BMCurrentLayerKey,document.getElementById("dlgconfirm").style.display="none"})}),document.getElementById($).addEventListener("click",function(){this.parentNode.remove()}),document.getElementById(u).addEventListener("input",function(s){var z=s.target.innerText;a.options.BMTitle!==z&&S(z),this.parentNode.dataset.t=z})}function yt(){document.getElementById("btGoOSM").addEventListener("click",function(){var e=k(),t=a.getZoom(),o=`https://www.openstreetmap.org/#map=${t}/${e.lat}/${e.lng}`;window.open(o)}),document.getElementById("btGoGoogle").addEventListener("click",function(){var e=k(),t=`https://www.google.com/maps/search/?api=1&query=${e.lat},${e.lng}`;window.open(t)}),document.getElementById("btGoGoogleEarth").addEventListener("click",function(){var e=k(),t=a.getZoom(),o=w(),n=Math.pow(2,20-t)*4096;console.log(`z=${t} d=${n}`);var r=`https://earth.google.com/web/@${e.lat},${e.lng},${n}d,${-o}h`;window.open(r)}),document.getElementById("btGoBing").addEventListener("click",function(){var e=k(),t=a.getZoom(),o=w(),n=-o,r=`https://www.bing.com/maps?cp=${e.lat}~${e.lng}&lvl=${t}&dir=${n}`;console.log(r),window.open(r)}),document.getElementById("btFavAdd").addEventListener("click",function(){A("*** name ***",a.options.BMHasMarker,w(),E(),T(),O(),a.options.BMCurrentLayerKey)}),document.getElementById("btFavSave").addEventListener("click",function(){ut();for(var e=document.getElementById("FavTableBody"),t=0,o;o=e.rows[t];t++){var n={t:o.dataset.t,m:o.dataset.m,rot:o.dataset.rot,l:o.dataset.l,lat:o.dataset.lat,lng:o.dataset.lng,z:o.dataset.z};gt(n)}}),document.getElementById("btFavUndo").addEventListener("click",function(){var e=document.getElementById("FavTableBody");e.innerHTML="",ie()}),document.getElementById("btFavExport").addEventListener("click",function(){for(var e=document.getElementById("FavTableBody"),t=[],o=0,n;n=e.rows[o];o++){var r={t:n.dataset.t,m:n.dataset.m,rot:n.dataset.rot,l:n.dataset.l,lat:n.dataset.lat,lng:n.dataset.lng,z:n.dataset.z};t.push(r)}mt(JSON.stringify(t),"BMFavorites.json","text/plain")}),document.getElementById("btFavImport").addEventListener("click",st),document.getElementById("btFavCancelUpload").addEventListener("click",ct),document.getElementById("btFavDoUpload").addEventListener("click",dt),document.getElementById("btFlipMarker").addEventListener("click",function(){le()}),document.getElementById("btTrack").addEventListener("click",function(){It()}),document.getElementById("btGoHere").addEventListener("click",function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(Xe,et)}),document.getElementById("shareToClipboard").addEventListener("click",function(){navigator.clipboard.writeText(window.location.href)}),document.getElementById("shareToMail").addEventListener("click",function(){var e=encodeURIComponent(window.location.href),t=encodeURIComponent(a.options.BMTitle),o=`mailto:?subject=${t}&body=${t}%0A${e}`;document.location=o}),document.getElementById("btMeasure").addEventListener("click",function(){te._toggleMeasure(),a.options.BMHasMeasure=!a.options.BMHasMeasure,ae(a.options.BMHasMeasure)}),document.getElementById("headFavPlace").addEventListener("click",function(){de("FavTable",0,!1)})}function P(){document.getElementById("btEdit").style.display="inline-block",document.getElementById("btEditSave").style.display="none",document.getElementById("btEditCancel").style.display="none",document.getElementById("fTitle").disabled=!0,document.getElementById("fRot").disabled=!0,document.getElementById("fLat").disabled=!0,document.getElementById("fLng").disabled=!0,document.getElementById("fZoom").disabled=!0}function ft(){var e,t,o,n,r;document.getElementById("btEdit").addEventListener("click",function(){e=Qe(),t=w(),o=E(),n=T(),r=O(),document.getElementById("btEdit").style.display="none",document.getElementById("btEditSave").style.display="inline-block",document.getElementById("btEditCancel").style.display="inline-block",document.getElementById("fTitle").disabled=!1,document.getElementById("fRot").disabled=!1,document.getElementById("fLat").disabled=!1,document.getElementById("fLng").disabled=!1,document.getElementById("fZoom").disabled=!1}),document.getElementById("btEditSave").addEventListener("click",function(){P();var i=document.getElementById("fTitle").value;i!=e&&S(i);var d=R(document.getElementById("fRot").value);d!=t&&(a.setBearing(d),x(d));var m=tt(document.getElementById("fLat").value),l=ot(document.getElementById("fLng").value);(m!=o||l!=n)&&(a.panTo(new L.LatLng(m,l),u),m!=o&&f(m),l!=n&&v(l));var u=at(document.getElementById("fZoom").value);u!=r&&(a.setZoom(u),I(u))}),document.getElementById("btEditCancel").addEventListener("click",function(){P(),document.getElementById("fTitle").value=e,document.getElementById("fRot").value=t})}function vt(e){if(console.log(e),Array.isArray(e.results)&&e.results.length>0){var t=e.results[0],o=t.geometry.lat,n=t.geometry.lng;a.panTo(new L.LatLng(o,n),{}),f(o),v(n)}}function ht(){document.getElementById("fSearch").addEventListener("change",function(){var e=document.getElementById("fSearch").value,t="a1f15d3f6b834c55917fd7e435af418c",o=`https://api.opencagedata.com/geocode/v1/json?q=${e}&key=${t}`;console.log(e),fetch(o).then(n=>n.json()).then(n=>vt(n))})}function se(e,t){p=new L.Marker([e,t],{draggable:!0}),p.bindTooltip(a.options.BMTitle),p.on("dragend",function(o){var n=p.getLatLng().lat,r=p.getLatLng().lng;f(n),v(r)}),a.addLayer(p)}function Mt(){var e=a.getCenter().lat,t=a.getCenter().lng;se(e,t)}function le(){Bt()?ce():(Mt(),a.options.BMHasMarker=!0),N(a.options.BMHasMarker)}function Bt(){var e=!1;return a.eachLayer(t=>{t instanceof L.Marker&&(e=!0)}),e}function ce(){a.eachLayer(e=>{e instanceof L.Marker&&e.remove()}),a.options.BMHasMarker=!1,N(!1)}function q(){window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission?window.DeviceMotionEvent.requestPermission().then(e=>{e==="granted"&&window.addEventListener("devicemotion",C)}).catch(console.error):window.DeviceOrientationEvent?window.addEventListener("deviceorientationabsolute",C):console.log("Device motion or orientation is not supported by this browser.")}function C(e){let t=null;if(e.rotationRate?t=e.rotationRate.alpha:e.alpha&&(t=e.alpha),t!==null){const o=t;G&&(a.setBearing(o),x(o))}}function bt(){G=!0,q(),setInterval(q,fe)}function Lt(){G=!1,window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission?window.removeEventListener("devicemotion",C):window.DeviceOrientationEvent&&window.removeEventListener("deviceorientationabsolute",C)}function W(){navigator.geolocation?navigator.geolocation.getCurrentPosition(wt):console.log("Geolocation is not supported by this browser.")}function wt(e){var t=e.coords.latitude,o=e.coords.longitude;U&&(f(t),v(o),a.panTo({lng:o,lat:t}))}function Et(){U=!0,W(),oe=setInterval(W,1e4)}function Tt(){U=!1,clearInterval(oe)}function It(){a.options.BMHasTracker?(L.geotagPhoto.crosshair().removeFrom(a),document.querySelectorAll(".leaflet-geotag-photo-crosshair").forEach(t=>t.remove()),Tt(),Lt()):(L.geotagPhoto.crosshair().addTo(a).on("input",function(e){this.getCrosshairPoint()}),Et(),bt()),a.options.BMHasTracker=!a.options.BMHasTracker,ne(a.options.BMHasTracker)}function de(e,t,o=!1){const n=document.getElementById(e),r=n.querySelector("tbody"),i=Array.from(r.getElementsByTagName("tr")),d=n.querySelector("thead tr");i.sort((m,l)=>{const u=m.getElementsByTagName("td")[t].textContent.trim(),b=l.getElementsByTagName("td")[t].textContent.trim();return o?b.localeCompare(u):u.localeCompare(b)}),o&&i.reverse(),r.innerHTML="",i.forEach(m=>r.appendChild(m)),n.querySelector("thead").appendChild(d)}
